import{_ as n}from"./Comment.173f8bf9.js";import{_ as s}from"./app.9a86a0a7.js";import{h as a,o as e,a as o,w as t,b as l,k as p}from"./vendor.57ddf3fb.js";const c=l("p",null,"postgresql 是一款开源的对象关系数据库管理系统。pg 可以说是一款全栈的数据库，毕竟 slogan 是 “世界上最先进的关系型数据库”。同时 pg 比 mysql 少不少的坑，使用上会舒心一些。 本文主要是记录 pg 的使用方式，同时也会记录一些 sql 的语句或者 pg 独有的一些操作。",-1),r=l("h3",{id:"ⅰ-创建用户"},[l("a",{class:"header-anchor",href:"#ⅰ-创建用户","aria-hidden":"true"},"#"),p(" Ⅰ 创建用户")],-1),k=l("p",null,[p("pg 安装后默认会有一个 "),l("code",null,"postgres"),p(" 的用户，要创建新用户，需要先切换到该账户，然后执行如下的操作。")],-1),u=l("pre",{class:"language-sql"},[l("code",{class:"language-sql"},[p("$ su "),l("span",{class:"token operator"},"-"),p(" postgres\n"),l("span",{class:"token operator"},"-"),p("bash"),l("span",{class:"token operator"},"-"),l("span",{class:"token number"},"4.2"),p("$ psql\npostgre"),l("span",{class:"token operator"},"="),l("span",{class:"token comment"},"# create user username with password 'xxxxx';"),p("\npostgre"),l("span",{class:"token operator"},"="),l("span",{class:"token comment"},"# create database databaseName owner username;"),p("\npostgre"),l("span",{class:"token operator"},"="),l("span",{class:"token comment"},"# grant all privileges on database databaseName to username;"),p("\n")])],-1),d=l("h3",{id:"ⅱ-登录数据库"},[l("a",{class:"header-anchor",href:"#ⅱ-登录数据库","aria-hidden":"true"},"#"),p(" Ⅱ 登录数据库")],-1),i=l("p",null,"使用用户名密码登录：",-1),m=l("pre",{class:"language-sql"},[l("code",{class:"language-sql"},[p("$ psql "),l("span",{class:"token operator"},"-"),p("h hosturl "),l("span",{class:"token operator"},"-"),p("U username "),l("span",{class:"token operator"},"-"),p("d databasename "),l("span",{class:"token operator"},"-"),p("p port\n")])],-1),g=l("p",null,[l("strong",null,"注意"),p(" 在一些编程的库中使用上面的方式可能会报 "),l("code",null,"sslmode required not support"),p(" 。通过增加 "),l("code",null,"sslmode=disable"),p(" 可以解决。")],-1),w=l("h3",{id:"ⅲ-导入导出"},[l("a",{class:"header-anchor",href:"#ⅲ-导入导出","aria-hidden":"true"},"#"),p(" Ⅲ 导入导出")],-1),y=l("p",null,"可以通过一些外部命令将 pg 数据库中的内容导出到一个 sql 文件中，同时也可以将这个 sql 文件重新应用到另外的数据库中。操作如下：",-1),h=l("pre",{class:"language-sql"},[l("code",{class:"language-sql"},[l("span",{class:"token comment"},"# export to dump.sql"),p("\n$ pg_dump "),l("span",{class:"token operator"},"-"),p("h hosturl "),l("span",{class:"token operator"},"-"),p("U username databasename "),l("span",{class:"token operator"},">"),p(),l("span",{class:"token operator"},"/"),p("path"),l("span",{class:"token operator"},"/"),p("tp"),l("span",{class:"token operator"},"/"),l("span",{class:"token keyword"},"save"),l("span",{class:"token operator"},"/"),l("span",{class:"token keyword"},"dump"),l("span",{class:"token punctuation"},"."),l("span",{class:"token keyword"},"sql"),p("\n\n"),l("span",{class:"token comment"},"# import to new database "),p("\n$ psql "),l("span",{class:"token operator"},"-"),p("h hosturl "),l("span",{class:"token operator"},"-"),p("d "),l("span",{class:"token keyword"},"database"),p(),l("span",{class:"token operator"},"-"),p("U username "),l("span",{class:"token operator"},"-"),p("f "),l("span",{class:"token keyword"},"dump"),l("span",{class:"token punctuation"},"."),l("span",{class:"token keyword"},"sql"),p("\n")])],-1),L=l("p",null,"此外导出单独一个表的操作如下：",-1),T=l("pre",{class:"language-sql"},[l("code",{class:"language-sql"},[p("pg_dump "),l("span",{class:"token operator"},"-"),p("h localhost "),l("span",{class:"token operator"},"-"),p("p "),l("span",{class:"token number"},"5432"),p(),l("span",{class:"token operator"},"-"),p("U username "),l("span",{class:"token comment"},"--format plain --verbose \\"),p("\n   "),l("span",{class:"token comment"},"--file dump.sql --table public.tablename dbname"),p("\n")])],-1),b=p("不过从高版本导出后，再导入到低版本时会有一些小错误。"),q=l("strong",null,[p("一般可以通过 "),l("code",null,"sed"),p(" 将对应的行注释掉。")],-1),A=l("h3",{id:"ⅳ-插入数据"},[l("a",{class:"header-anchor",href:"#ⅳ-插入数据","aria-hidden":"true"},"#"),p(" Ⅳ 插入数据")],-1),E=l("p",null,"values 可以指定多个，批量插入。",-1),_=l("pre",{class:"language-sql"},[l("code",{class:"language-sql"},[l("span",{class:"token keyword"},"insert"),p(),l("span",{class:"token keyword"},"into"),p(" table_name "),l("span",{class:"token punctuation"},"("),p("column1"),l("span",{class:"token punctuation"},","),p(" column2"),l("span",{class:"token punctuation"},","),p(" column3"),l("span",{class:"token punctuation"},")"),p(),l("span",{class:"token keyword"},"values"),p(),l("span",{class:"token punctuation"},"("),p("value1"),l("span",{class:"token punctuation"},","),p(" value2"),l("span",{class:"token punctuation"},","),p(" value3"),l("span",{class:"token punctuation"},")"),l("span",{class:"token punctuation"},"["),l("span",{class:"token punctuation"},","),l("span",{class:"token punctuation"},"("),l("span",{class:"token punctuation"},","),l("span",{class:"token punctuation"},"."),l("span",{class:"token punctuation"},"."),l("span",{class:"token punctuation"},"."),l("span",{class:"token punctuation"},")"),l("span",{class:"token punctuation"},"]"),l("span",{class:"token punctuation"},";"),p("\n")])],-1),N=l("h3",{id:"ⅴ-更新数据"},[l("a",{class:"header-anchor",href:"#ⅴ-更新数据","aria-hidden":"true"},"#"),p(" Ⅴ 更新数据")],-1),f=l("pre",{class:"language-sql"},[l("code",{class:"language-sql"},[l("span",{class:"token keyword"},"UPDATE"),p(" table_name\n"),l("span",{class:"token keyword"},"SET"),p(" column1 "),l("span",{class:"token operator"},"="),p(" value1"),l("span",{class:"token punctuation"},","),p(" column2 "),l("span",{class:"token operator"},"="),p(" value2"),l("span",{class:"token punctuation"},"."),l("span",{class:"token punctuation"},"."),l("span",{class:"token punctuation"},"."),l("span",{class:"token punctuation"},"."),l("span",{class:"token punctuation"},","),p(" columnN "),l("span",{class:"token operator"},"="),p(" valueN\n"),l("span",{class:"token keyword"},"WHERE"),p(),l("span",{class:"token punctuation"},"["),p("condition"),l("span",{class:"token punctuation"},"]"),l("span",{class:"token punctuation"},";"),p("\n"),l("span",{class:"token keyword"},"RETURNING"),p(),l("span",{class:"token operator"},"*"),p(),l("span",{class:"token operator"},"|"),p(" output_expression "),l("span",{class:"token keyword"},"AS"),p(" output_name"),l("span",{class:"token punctuation"},";"),p("\n")])],-1),R=l("p",null,[l("code",null,"RETURNING"),p(" 表示返回更新后符合条件的记录")],-1),U=l("h3",{id:"ⅵ-修改表格字段"},[l("a",{class:"header-anchor",href:"#ⅵ-修改表格字段","aria-hidden":"true"},"#"),p(" Ⅵ 修改表格字段")],-1),v=l("pre",{class:"language-sql"},[l("code",{class:"language-sql"},[l("span",{class:"token comment"},"# 增加字段"),p("\n"),l("span",{class:"token keyword"},"ALTER"),p(),l("span",{class:"token keyword"},"TABLE"),p(" table_name \n"),l("span",{class:"token keyword"},"ADD"),p(),l("span",{class:"token keyword"},"COLUMN"),p(" column_name datatype column_constraint"),l("span",{class:"token punctuation"},";"),p("\n\n"),l("span",{class:"token comment"},"# 删除字段"),p("\n"),l("span",{class:"token keyword"},"ALTER"),p(),l("span",{class:"token keyword"},"TABLE"),p(" table_name \n"),l("span",{class:"token keyword"},"DROP"),p(),l("span",{class:"token keyword"},"COLUMN"),p(" column_name"),l("span",{class:"token punctuation"},";"),p("\n\n"),l("span",{class:"token comment"},"# 重命名字段"),p("\n"),l("span",{class:"token keyword"},"ALTER"),p(),l("span",{class:"token keyword"},"TABLE"),p(" table_name \n"),l("span",{class:"token keyword"},"RENAME"),p(),l("span",{class:"token keyword"},"COLUMN"),p(" column_name \n"),l("span",{class:"token keyword"},"TO"),p(" new_column_name"),l("span",{class:"token punctuation"},";"),p("\n\n"),l("span",{class:"token comment"},"# 改变默认值"),p("\n"),l("span",{class:"token keyword"},"ALTER"),p(),l("span",{class:"token keyword"},"TABLE"),p(" table_name \n"),l("span",{class:"token keyword"},"ALTER"),p(),l("span",{class:"token keyword"},"COLUMN"),p(" column_name \n"),l("span",{class:"token punctuation"},"["),l("span",{class:"token keyword"},"SET"),p(),l("span",{class:"token keyword"},"DEFAULT"),p(),l("span",{class:"token keyword"},"value"),p(),l("span",{class:"token operator"},"|"),p(),l("span",{class:"token keyword"},"DROP"),p(),l("span",{class:"token keyword"},"DEFAULT"),l("span",{class:"token punctuation"},"]"),l("span",{class:"token punctuation"},";"),p("\n\n"),l("span",{class:"token comment"},"# 修改 not null 限制"),p("\n"),l("span",{class:"token keyword"},"ALTER"),p(),l("span",{class:"token keyword"},"TABLE"),p(" table_name \n"),l("span",{class:"token keyword"},"ALTER"),p(),l("span",{class:"token keyword"},"COLUMN"),p(" column_name \n"),l("span",{class:"token punctuation"},"["),l("span",{class:"token keyword"},"SET"),p(),l("span",{class:"token operator"},"NOT"),p(),l("span",{class:"token boolean"},"NULL"),l("span",{class:"token operator"},"|"),p(),l("span",{class:"token keyword"},"DROP"),p(),l("span",{class:"token operator"},"NOT"),p(),l("span",{class:"token boolean"},"NULL"),l("span",{class:"token punctuation"},"]"),l("span",{class:"token punctuation"},";"),p("\n\n"),l("span",{class:"token comment"},"# 增加check限制"),p("\n"),l("span",{class:"token keyword"},"ALTER"),p(),l("span",{class:"token keyword"},"TABLE"),p(" table_name \n"),l("span",{class:"token keyword"},"ADD"),p(),l("span",{class:"token keyword"},"CONSTRAINT"),p(" constraint_name constraint_definition"),l("span",{class:"token punctuation"},";"),p("\n\n"),l("span",{class:"token comment"},"# 增加其他限制"),p("\n"),l("span",{class:"token keyword"},"ALTER"),p(),l("span",{class:"token keyword"},"TABLE"),p(" table_name \n"),l("span",{class:"token keyword"},"ADD"),p(),l("span",{class:"token keyword"},"CONSTRAINT"),p(" constraint_name constraint_definition"),l("span",{class:"token punctuation"},";"),p("\n\n"),l("span",{class:"token comment"},"# 重命名表"),p("\n"),l("span",{class:"token keyword"},"ALTER"),p(),l("span",{class:"token keyword"},"TABLE"),p(" table_name \n"),l("span",{class:"token keyword"},"RENAME"),p(),l("span",{class:"token keyword"},"TO"),p(" new_table_name"),l("span",{class:"token punctuation"},";"),p("\n")])],-1),O={expose:[],setup(p){const O={title:"PostgreSQL In Action",date:"2021-01-25T00:00:00.000Z",author:"Linkang Chan",twitter:"JessEisen_LJ",description:"postgresql",public:!0,tag:"21B12 postgresql",meta:[{property:"og:title",content:"PostgreSQL In Action"},{property:"og:description",content:"postgresql"},{name:"description",content:"postgresql"}]};return a({title:"PostgreSQL In Action",meta:[{property:"og:title",content:"PostgreSQL In Action"},{property:"og:description",content:"postgresql"},{name:"description",content:"postgresql"}]}),(a,p)=>{const D=n,S=s;return e(),o(S,{frontmatter:O},{default:t((()=>[l("div",null,[c,r,k,u,d,i,m,g,w,y,h,L,T,l("p",null,[l(D,null,{default:t((()=>[b,q])),_:1})]),A,E,_,N,f,R,U,v])])),_:1})}}};export default O;
