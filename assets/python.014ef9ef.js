import{_ as n}from"./app.ac55e7e1.js";import{h as s,o as a,a as t,w as o,b as e,k as p}from"./vendor.5a394a79.js";const c=e("div",null,[e("h2",{id:"command-line-argument-parse"},[e("a",{class:"header-anchor",href:"#command-line-argument-parse","aria-hidden":"true"},"#"),p(" command line argument parse")]),e("p",null,[p("使用 ["),e("a",{href:"https://click.palletsprojects.com/en/7.x/",target:"_blank",rel:"noopener"},"click"),p("] 作为解析库，可以方便的实现子命令操作。整理一些使用中遇到的问题。")]),e("ul",null,[e("li",null,"对 argument 进行注释")]),e("p",null,[p("使用多行注释的方式 "),e("code",null,'""" xxx """'),p("。但是 click 默认是现在在统一行，去除掉了换行的操作。所以在有多参数的情况下显示比较乱。解决方式是：")]),e("pre",{class:"language-python"},[e("code",{class:"language-python"},[e("span",{class:"token decorator annotation punctuation"},[p("@click"),e("span",{class:"token punctuation"},"."),p("command")]),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),p("\n"),e("span",{class:"token decorator annotation punctuation"},[p("@click"),e("span",{class:"token punctuation"},"."),p("argument")]),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},"'gt'"),e("span",{class:"token punctuation"},","),p(),e("span",{class:"token builtin"},"type"),e("span",{class:"token operator"},"="),p("click"),e("span",{class:"token punctuation"},"."),p("Path"),e("span",{class:"token punctuation"},"("),p("exists"),e("span",{class:"token operator"},"="),e("span",{class:"token boolean"},"True"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},")"),p("\n"),e("span",{class:"token decorator annotation punctuation"},[p("@click"),e("span",{class:"token punctuation"},"."),p("argument")]),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},"'prefix'"),e("span",{class:"token punctuation"},","),p(),e("span",{class:"token builtin"},"type"),e("span",{class:"token operator"},"="),p("click"),e("span",{class:"token punctuation"},"."),p("Path"),e("span",{class:"token punctuation"},"("),p("exists"),e("span",{class:"token operator"},"="),e("span",{class:"token boolean"},"True"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},")"),p("\n"),e("span",{class:"token keyword"},"def"),p(),e("span",{class:"token function"},"execute"),e("span",{class:"token punctuation"},"("),p("gt"),e("span",{class:"token punctuation"},","),p(" prefix"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},":"),p("\n    "),e("span",{class:"token triple-quoted-string string"},'"""\n       \\b \n       explain the command usage\n       gt: xxxx\n       prefix: xxxxx\n    """'),p("\n")])]),e("h2",{id:"progess-bar"},[e("a",{class:"header-anchor",href:"#progess-bar","aria-hidden":"true"},"#"),p(" progess bar")]),e("p",null,[p("使用 ["),e("a",{href:"https://github.com/tqdm/tqdm",target:"_blank",rel:"noopener"},"tqdm"),p("] 搭配各种场景使用，比如在 requests 中显示现在的进度时，可以有如下的方式：")]),e("pre",{class:"language-python"},[e("code",{class:"language-python"},[p("r "),e("span",{class:"token operator"},"="),p(" requests"),e("span",{class:"token punctuation"},"."),p("get"),e("span",{class:"token punctuation"},"("),p("url"),e("span",{class:"token punctuation"},","),p(" stream"),e("span",{class:"token operator"},"="),e("span",{class:"token boolean"},"True"),e("span",{class:"token punctuation"},","),p(" allow_redirects"),e("span",{class:"token operator"},"="),e("span",{class:"token boolean"},"True"),e("span",{class:"token punctuation"},")"),p("\n"),e("span",{class:"token punctuation"},"."),e("span",{class:"token punctuation"},"."),e("span",{class:"token punctuation"},"."),p(),e("span",{class:"token comment"},"# status code check "),p("\npath "),e("span",{class:"token operator"},"="),p(" pathlib"),e("span",{class:"token punctuation"},"."),p("Path"),e("span",{class:"token punctuation"},"("),p("filename"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},"."),p("expanduser"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},"."),p("resolve"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),p("\npath"),e("span",{class:"token punctuation"},"."),p("parent"),e("span",{class:"token punctuation"},"."),p("mkdir"),e("span",{class:"token punctuation"},"("),p("parents"),e("span",{class:"token operator"},"="),e("span",{class:"token boolean"},"True"),e("span",{class:"token punctuation"},","),p(" exist_ok"),e("span",{class:"token operator"},"="),e("span",{class:"token boolean"},"True"),e("span",{class:"token punctuation"},")"),p("\n\ndesc "),e("span",{class:"token operator"},"="),p(" filename"),e("span",{class:"token punctuation"},"."),p("ljust"),e("span",{class:"token punctuation"},"("),e("span",{class:"token number"},"22"),e("span",{class:"token punctuation"},","),p(),e("span",{class:"token string"},"' '"),e("span",{class:"token punctuation"},")"),p(),e("span",{class:"token comment"},"# 22 is the lenght bigger than filename, should change"),p("\nr"),e("span",{class:"token punctuation"},"."),p("raw"),e("span",{class:"token punctuation"},"."),p("read "),e("span",{class:"token operator"},"="),p(" functools"),e("span",{class:"token punctuation"},"."),p("partial"),e("span",{class:"token punctuation"},"("),p("r"),e("span",{class:"token punctuation"},"."),p("raw"),e("span",{class:"token punctuation"},"."),p("read"),e("span",{class:"token punctuation"},","),p(" decode_content"),e("span",{class:"token operator"},"="),e("span",{class:"token boolean"},"True"),e("span",{class:"token punctuation"},")"),p("  "),e("span",{class:"token comment"},"# Decompress if needed"),p("\n"),e("span",{class:"token keyword"},"with"),p(" tqdm"),e("span",{class:"token punctuation"},"."),p("tqdm"),e("span",{class:"token punctuation"},"."),p("wrapattr"),e("span",{class:"token punctuation"},"("),p("r"),e("span",{class:"token punctuation"},"."),p("raw"),e("span",{class:"token punctuation"},","),p(),e("span",{class:"token string"},'"read"'),e("span",{class:"token punctuation"},","),p(" total"),e("span",{class:"token operator"},"="),p("file_size"),e("span",{class:"token punctuation"},","),p(" desc"),e("span",{class:"token operator"},"="),p("desc"),e("span",{class:"token punctuation"},")"),p(),e("span",{class:"token keyword"},"as"),p(" r_raw"),e("span",{class:"token punctuation"},":"),p("\n     "),e("span",{class:"token keyword"},"with"),p(" path"),e("span",{class:"token punctuation"},"."),e("span",{class:"token builtin"},"open"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},'"wb"'),e("span",{class:"token punctuation"},")"),p(),e("span",{class:"token keyword"},"as"),p(" f"),e("span",{class:"token punctuation"},":"),p("\n            shutil"),e("span",{class:"token punctuation"},"."),p("copyfileobj"),e("span",{class:"token punctuation"},"("),p("r_raw"),e("span",{class:"token punctuation"},","),p(" f"),e("span",{class:"token punctuation"},")"),p("\n")])]),e("p",null,"同时也可以在命令行中使用："),e("pre",{class:"language-python"},[e("code",{class:"language-python"},[p("find "),e("span",{class:"token punctuation"},"."),p(),e("span",{class:"token operator"},"-"),p("name "),e("span",{class:"token string"},"'*.py'"),p(),e("span",{class:"token operator"},"-"),e("span",{class:"token builtin"},"type"),p(" f "),e("span",{class:"token operator"},"-"),e("span",{class:"token keyword"},"exec"),p(" cat \\"),e("span",{class:"token punctuation"},"{"),e("span",{class:"token punctuation"},"}"),p(" \\"),e("span",{class:"token punctuation"},";"),p(" \\\n  "),e("span",{class:"token operator"},"|"),p(" tqdm "),e("span",{class:"token operator"},"-"),e("span",{class:"token operator"},"-"),p("unit loc "),e("span",{class:"token operator"},"-"),e("span",{class:"token operator"},"-"),p("unit_scale "),e("span",{class:"token operator"},"-"),e("span",{class:"token operator"},"-"),p("total "),e("span",{class:"token number"},"857366"),p(),e("span",{class:"token operator"},">>"),p(),e("span",{class:"token operator"},"/"),p("dev"),e("span",{class:"token operator"},"/"),p("null\n"),e("span",{class:"token number"},"100"),e("span",{class:"token operator"},"%"),e("span",{class:"token operator"},"|"),p("█████████████████████████████████"),e("span",{class:"token operator"},"|"),p(" 857K"),e("span",{class:"token operator"},"/"),p("857K "),e("span",{class:"token punctuation"},"["),e("span",{class:"token number"},"00"),e("span",{class:"token punctuation"},":"),e("span",{class:"token number"},"04"),e("span",{class:"token operator"},"<"),e("span",{class:"token number"},"00"),e("span",{class:"token punctuation"},":"),e("span",{class:"token number"},"00"),e("span",{class:"token punctuation"},","),p(" 246Kloc"),e("span",{class:"token operator"},"/"),p("s"),e("span",{class:"token punctuation"},"]"),p("\n")])]),e("p",null,[p("更多使用参考文档 ["),e("a",{href:"https://tqdm.github.io/docs",target:"_blank",rel:"noopener"},"tqdm documention"),p("] 。")]),e("h2",{id:"requirements-txt"},[e("a",{class:"header-anchor",href:"#requirements-txt","aria-hidden":"true"},"#"),p(" requirements.txt")]),e("p",null,"这个文件可以用于python项目初始化时安装依赖使用。可以通过两种方式获取到："),e("pre",{class:"language-python"},[e("code",{class:"language-python"},[e("span",{class:"token comment"},"# 获取完整的依赖环境"),p("\n$ pip3 freeze "),e("span",{class:"token operator"},">"),p(" requirements"),e("span",{class:"token punctuation"},"."),p("txt\n\n"),e("span",{class:"token comment"},"# 获取必要的依赖"),p("\n$ pip install pipreqs\n$ pipreqs "),e("span",{class:"token punctuation"},"."),p("\n\n"),e("span",{class:"token comment"},"# 使用"),p("\n$ pip install "),e("span",{class:"token operator"},"-"),p("r requirements"),e("span",{class:"token punctuation"},"."),p("txt\n")])]),e("h2",{id:"tar-file"},[e("a",{class:"header-anchor",href:"#tar-file","aria-hidden":"true"},"#"),p(" tar file")]),e("p",null,"获取 tar.gz 文件中的顶层目录的名称，使用下面简单的方式："),e("pre",{class:"language-python"},[e("code",{class:"language-python"},[p("archive "),e("span",{class:"token operator"},"="),p(" tarfile"),e("span",{class:"token punctuation"},"."),e("span",{class:"token builtin"},"open"),e("span",{class:"token punctuation"},"("),p("filepath"),e("span",{class:"token punctuation"},","),p(" mode"),e("span",{class:"token operator"},"="),e("span",{class:"token string"},"'r'"),e("span",{class:"token punctuation"},")"),p("\n"),e("span",{class:"token keyword"},"print"),p(" os"),e("span",{class:"token punctuation"},"."),p("path"),e("span",{class:"token punctuation"},"."),p("commonprefix"),e("span",{class:"token punctuation"},"("),p("archive"),e("span",{class:"token punctuation"},"."),p("getnames"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},")"),p("\n")])]),e("h2",{id:"zip-file"},[e("a",{class:"header-anchor",href:"#zip-file","aria-hidden":"true"},"#"),p(" zip file")]),e("p",null,"使用 zipfile 库，更加灵活的打包 zip 包。"),e("pre",{class:"language-python"},[e("code",{class:"language-python"},[e("span",{class:"token keyword"},"from"),p(" zipfile "),e("span",{class:"token keyword"},"import"),p(" ZipFile\n\n"),e("span",{class:"token keyword"},"with"),p(" ZipFile"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},"'target.zip'"),e("span",{class:"token punctuation"},","),p(),e("span",{class:"token string"},"'w'"),e("span",{class:"token punctuation"},")"),p(),e("span",{class:"token keyword"},"as"),p(" newzip"),e("span",{class:"token punctuation"},":"),p("\n    newzip"),e("span",{class:"token punctuation"},"."),p("write"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},"'directory_name'"),e("span",{class:"token punctuation"},")"),p("\n    newzip"),e("span",{class:"token punctuation"},"."),p("write"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},"'file_name'"),e("span",{class:"token punctuation"},")"),p("\n")])]),e("p",null,"使用 shutil 中的 make_archive 函数生成的包有点奇怪(?)，不如使用 zipfile 来的灵活。"),e("h2",{id:"subprocess"},[e("a",{class:"header-anchor",href:"#subprocess","aria-hidden":"true"},"#"),p(" subprocess")]),e("p",null,"使用 subprocess 时，往往需要添加子进程中的环境变量，可以使用:"),e("pre",{class:"language-python"},[e("code",{class:"language-python"},[e("span",{class:"token keyword"},"import"),p(" subprocess"),e("span",{class:"token punctuation"},","),p(" os\nmy_env "),e("span",{class:"token operator"},"="),p(" os"),e("span",{class:"token punctuation"},"."),p("environ"),e("span",{class:"token punctuation"},"."),p("copy"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),p("\nmy_env"),e("span",{class:"token punctuation"},"["),e("span",{class:"token string"},'"PATH"'),e("span",{class:"token punctuation"},"]"),p(),e("span",{class:"token operator"},"="),p(),e("span",{class:"token string"},'"/usr/sbin:/sbin:"'),p(),e("span",{class:"token operator"},"+"),p(" my_env"),e("span",{class:"token punctuation"},"["),e("span",{class:"token string"},'"PATH"'),e("span",{class:"token punctuation"},"]"),p("\nsubprocess"),e("span",{class:"token punctuation"},"."),p("Popen"),e("span",{class:"token punctuation"},"("),p("my_command"),e("span",{class:"token punctuation"},","),p(" env"),e("span",{class:"token operator"},"="),p("my_env"),e("span",{class:"token punctuation"},")"),p("\n")])]),e("h2",{id:"sh"},[e("a",{class:"header-anchor",href:"#sh","aria-hidden":"true"},"#"),p(" sh")]),e("p",null,"sh is a full-fledged subprocess replacement for Python 2.6 - 3.8, PyPy and PyPy3 that allows you to call any program as if it were a function."),e("pre",{class:"language-python"},[e("code",{class:"language-python"},[e("span",{class:"token keyword"},"import"),p(" sh\n"),e("span",{class:"token comment"},"# like command run in bash. $ sed -i 's/a/A/g' filename"),p("\nsh"),e("span",{class:"token punctuation"},"."),p("sed"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},"["),e("span",{class:"token string"},"'-i'"),e("span",{class:"token punctuation"},","),p(),e("span",{class:"token string-interpolation"},[e("span",{class:"token string"},"f's/a/A/g'")]),e("span",{class:"token punctuation"},","),p(" filename"),e("span",{class:"token punctuation"},"]"),e("span",{class:"token punctuation"},"}"),p("'"),e("span",{class:"token punctuation"},"]"),e("span",{class:"token punctuation"},")"),p("\n")])]),e("h2",{id:"format"},[e("a",{class:"header-anchor",href:"#format","aria-hidden":"true"},"#"),p(" format")]),e("p",null,[p("python 中用于格式的操作，在格式化数字的时候，可以方便的控制小数点后的面位数。具体的可以参考["),e("a",{href:"https://docs.python.org/3/library/string.html#format-examples",target:"_blank",rel:"noopener"},"string format"),p("]")]),e("pre",{class:"language-python"},[e("code",{class:"language-python"},[e("span",{class:"token string"},'"{:.2f}"'),e("span",{class:"token punctuation"},"."),e("span",{class:"token builtin"},"format"),e("span",{class:"token punctuation"},"("),e("span",{class:"token number"},"13.949999999999999"),e("span",{class:"token punctuation"},")"),p("\n")])]),e("h2",{id:"listdir"},[e("a",{class:"header-anchor",href:"#listdir","aria-hidden":"true"},"#"),p(" listdir")]),e("p",null,"python 中遍历目录有好几种方式，不同的方式满足于不同的场景。"),e("ul",null,[e("li",null,"os.listdir")]),e("p",null,"列举出当前目录下所有的文件，同时我们可以通过文件类型去进行过滤。比如："),e("pre",{class:"language-python"},[e("code",{class:"language-python"},[e("span",{class:"token keyword"},"import"),p(" os \n\nfiles "),e("span",{class:"token operator"},"="),p(),e("span",{class:"token punctuation"},"["),p("f "),e("span",{class:"token keyword"},"for"),p(" f "),e("span",{class:"token keyword"},"in"),p(" os"),e("span",{class:"token punctuation"},"."),p("listdir"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},"'.'"),e("span",{class:"token punctuation"},")"),p(),e("span",{class:"token keyword"},"if"),p(" os"),e("span",{class:"token punctuation"},"."),p("path"),e("span",{class:"token punctuation"},"."),p("isfile"),e("span",{class:"token punctuation"},"("),p("f"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},"]"),p("\ndirs "),e("span",{class:"token operator"},"="),p(),e("span",{class:"token punctuation"},"["),p("d "),e("span",{class:"token keyword"},"for"),p(" d "),e("span",{class:"token keyword"},"in"),p(" os"),e("span",{class:"token punctuation"},"."),p("listdir"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},"'.'"),e("span",{class:"token punctuation"},")"),p(),e("span",{class:"token keyword"},"if"),p(" os"),e("span",{class:"token punctuation"},"."),p("path"),e("span",{class:"token punctuation"},"."),p("isdir"),e("span",{class:"token punctuation"},"("),p("d"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},"]"),p("\n")])]),e("ul",null,[e("li",null,"os.walk")]),e("p",null,"walk 一般会递归去获取当前目录下所有的文件包含子目录，需要通过指定一些配置来满足我们的需求。简单的使用如下："),e("pre",{class:"language-python"},[e("code",{class:"language-python"},[e("span",{class:"token keyword"},"import"),p(" os\n\n"),e("span",{class:"token keyword"},"for"),p(" root"),e("span",{class:"token punctuation"},","),p(" dirs"),e("span",{class:"token punctuation"},","),p(" files "),e("span",{class:"token keyword"},"in"),p(" os"),e("span",{class:"token punctuation"},"."),p("walk"),e("span",{class:"token punctuation"},"("),e("span",{class:"token string"},"'.'"),e("span",{class:"token punctuation"},","),p(" topdown"),e("span",{class:"token operator"},"="),e("span",{class:"token boolean"},"True"),e("span",{class:"token punctuation"},")"),e("span",{class:"token punctuation"},":"),p("\n    dirs"),e("span",{class:"token punctuation"},"."),p("clear"),e("span",{class:"token punctuation"},"("),e("span",{class:"token punctuation"},")"),p("\n    "),e("span",{class:"token keyword"},"for"),p(),e("span",{class:"token builtin"},"file"),p(),e("span",{class:"token keyword"},"in"),p(" files"),e("span",{class:"token punctuation"},":"),p("\n        "),e("span",{class:"token keyword"},"print"),e("span",{class:"token punctuation"},"("),e("span",{class:"token builtin"},"file"),e("span",{class:"token punctuation"},")"),p("\n")])]),e("p",null,[e("code",null,"dirs.clear()"),p(" 用于不递归遍历当前目录下的子目录。 如果不删除，则会显示当前目录下所有的文件包含子目录里面的文件。这需要结合具体的场景。")]),e("ul",null,[e("li",null,"find(shell command with subprocess)")]),e("p",null,"这种方式是结合了 shell 的一些特性，一般不得以的情况下才使用。")],-1),l={expose:[],setup(e){const p={title:"Python Hard Way",date:"2021-01-21T00:00:00.000Z",author:"Linkang Chan",twitter:"JessEisen_LJ",description:"python docs",public:!0,tag:"21B07 python",meta:[{property:"og:title",content:"Python Hard Way"},{property:"og:description",content:"python docs"},{name:"description",content:"python docs"}]};return s({title:"Python Hard Way",meta:[{property:"og:title",content:"Python Hard Way"},{property:"og:description",content:"python docs"},{name:"description",content:"python docs"}]}),(s,e)=>{const l=n;return a(),t(l,{frontmatter:p},{default:o((()=>[c])),_:1})}}};export default l;
