import{_ as n}from"./LinkItem.65bc6d8d.js";import{_ as a}from"./app.252c1e4c.js";import{h as s,o as e,a as t,w as o,b as c,k as l}from"./vendor.80607e96.js";const p=c("p",null,"本篇笔记记录一些在类 Unix 系统上操作查看网络相关的内容，包括一些基本网络管理，查询，性能监测等等内容。",-1),r=c("h2",{id:"抓包"},[c("a",{class:"header-anchor",href:"#抓包","aria-hidden":"true"},"#"),l(" 抓包")],-1),u=c("p",null,"一般我们会使用 wireshark 来抓包，这个工具可以抓取网络中的数据包，并且可以对数据包进行分析。但是在 Linux 上我们可以通过如下的方式进行抓包：",-1),i=c("pre",{class:"language-bash"},[c("code",{class:"language-bash"},[c("span",{class:"token function"},"sudo"),l(" tcpdump -s "),c("span",{class:"token number"},"0"),l(" -A "),c("span",{class:"token string"},"'tcp[((tcp[12:1] & 0xf0) >> 2):4] = 0x47455420'"),l("\n")])],-1),k=c("p",null,"tcpdump过滤HTTP的POST请求:",-1),d=c("pre",{class:"language-bash"},[c("code",{class:"language-bash"},[c("span",{class:"token function"},"sudo"),l(" tcpdump -s "),c("span",{class:"token number"},"0"),l(" -A "),c("span",{class:"token string"},"'tcp dst port 80 and (tcp[((tcp[12:1] & 0xf0) >> 2):4] = 0x504f5354)'"),l("\n")])],-1),h=c("p",null,"tcpdump过滤HTTP的请求和响应头信息，以及请求和响应消息体信息：",-1),b=c("pre",{class:"language-bash"},[c("code",{class:"language-bash"},[l("tcpdump -A -s "),c("span",{class:"token number"},"0"),l(),c("span",{class:"token string"},[l("'tcp port 80 and "),c("span",{class:"token variable"},[c("span",{class:"token punctuation"},"(("),c("span",{class:"token punctuation"},"("),l("ip["),c("span",{class:"token number"},"2"),c("span",{class:"token operator"},":"),c("span",{class:"token number"},"2"),l("] "),c("span",{class:"token operator"},"-"),l(),c("span",{class:"token punctuation"},"(("),l("ip["),c("span",{class:"token number"},"0"),l("]"),c("span",{class:"token operator"},"&"),c("span",{class:"token number"},"0xf"),c("span",{class:"token punctuation"},")"),c("span",{class:"token operator"},"<<"),c("span",{class:"token number"},"2"),c("span",{class:"token punctuation"},"))")]),l(" - "),c("span",{class:"token variable"},[c("span",{class:"token punctuation"},"(("),l("tcp["),c("span",{class:"token number"},"12"),l("]"),c("span",{class:"token operator"},"&"),c("span",{class:"token number"},"0xf0"),c("span",{class:"token punctuation"},")"),c("span",{class:"token operator"},">>"),c("span",{class:"token number"},"2"),c("span",{class:"token punctuation"},"))")]),l(" != 0)'")]),l("\ntcpdump -X -s "),c("span",{class:"token number"},"0"),l(),c("span",{class:"token string"},[l("'tcp port 80 and "),c("span",{class:"token variable"},[c("span",{class:"token punctuation"},"(("),c("span",{class:"token punctuation"},"("),l("ip["),c("span",{class:"token number"},"2"),c("span",{class:"token operator"},":"),c("span",{class:"token number"},"2"),l("] "),c("span",{class:"token operator"},"-"),l(),c("span",{class:"token punctuation"},"(("),l("ip["),c("span",{class:"token number"},"0"),l("]"),c("span",{class:"token operator"},"&"),c("span",{class:"token number"},"0xf"),c("span",{class:"token punctuation"},")"),c("span",{class:"token operator"},"<<"),c("span",{class:"token number"},"2"),c("span",{class:"token punctuation"},"))")]),l(" - "),c("span",{class:"token variable"},[c("span",{class:"token punctuation"},"(("),l("tcp["),c("span",{class:"token number"},"12"),l("]"),c("span",{class:"token operator"},"&"),c("span",{class:"token number"},"0xf0"),c("span",{class:"token punctuation"},")"),c("span",{class:"token operator"},">>"),c("span",{class:"token number"},"2"),c("span",{class:"token punctuation"},"))")]),l(" != 0)'")]),l("\n")])],-1),g=c("h2",{id:"查看端口使用情况"},[c("a",{class:"header-anchor",href:"#查看端口使用情况","aria-hidden":"true"},"#"),l(" 查看端口使用情况")],-1),m=c("pre",{class:"language-bash"},[c("code",{class:"language-bash"},[l("$ "),c("span",{class:"token function"},"netstat"),l(" -ntlp   "),c("span",{class:"token comment"},"#查看当前所有tcp端口·"),l("\n$ "),c("span",{class:"token function"},"netstat"),l(" -ntulp "),c("span",{class:"token operator"},"|"),l(),c("span",{class:"token function"},"grep"),l(),c("span",{class:"token number"},"80"),l("   "),c("span",{class:"token comment"},"#查看所有80端口使用情况·"),l("\n$ "),c("span",{class:"token function"},"netstat"),l(" -an "),c("span",{class:"token operator"},"|"),l(),c("span",{class:"token function"},"grep"),l(),c("span",{class:"token number"},"3306"),l("   "),c("span",{class:"token comment"},"#查看所有3306端口使用情况·"),l("\n")])],-1),f=c("p",null,"相关参数的解释：",-1),y=c("ul",null,[c("li",null,"n：不进行 DNS 解析，只显示 IP 地址和端口号；"),c("li",null,"t：显示 TCP 端口"),c("li",null,"u：显示 UDP 端口"),c("li",null,"l: 显示监听的 socket"),c("li",null,"p：显示标识符和进程号")],-1),x=c("h2",{id:"删除桥接网络"},[c("a",{class:"header-anchor",href:"#删除桥接网络","aria-hidden":"true"},"#"),l(" 删除桥接网络")],-1),w=c("pre",{class:"language-bash"},[c("code",{class:"language-bash"},[l("$ "),c("span",{class:"token function"},"sudo"),l(),c("span",{class:"token function"},"ip"),l(),c("span",{class:"token function"},"link"),l(" delete br0 "),c("span",{class:"token builtin class-name"},"type"),l(" bridge\n")])],-1),v=c("p",null,"如果该网络是由 docker 创建的，可以尝试使用",-1),$=c("pre",{class:"language-bash"},[c("code",{class:"language-bash"},"$ docker network prune\n")],-1),_=l(" 相关回答 "),T=c("h2",{id:"查看路由表"},[c("a",{class:"header-anchor",href:"#查看路由表","aria-hidden":"true"},"#"),l(" 查看路由表")],-1),L=c("pre",{class:"language-bash"},[c("code",{class:"language-bash"},[l("$ route -n\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n"),c("span",{class:"token number"},"0.0"),l(".0.0         "),c("span",{class:"token number"},"172.21"),l(".0.1      "),c("span",{class:"token number"},"0.0"),l(".0.0         UG    "),c("span",{class:"token number"},"100"),l("    "),c("span",{class:"token number"},"0"),l("        "),c("span",{class:"token number"},"0"),l(" eth0\n"),c("span",{class:"token number"},"172.17"),l(".0.0      "),c("span",{class:"token number"},"0.0"),l(".0.0         "),c("span",{class:"token number"},"255.255"),l(".0.0     U     "),c("span",{class:"token number"},"0"),l("      "),c("span",{class:"token number"},"0"),l("        "),c("span",{class:"token number"},"0"),l(" docker0\n"),c("span",{class:"token number"},"172.21"),l(".0.0      "),c("span",{class:"token number"},"0.0"),l(".0.0         "),c("span",{class:"token number"},"255.255"),l(".240.0   U     "),c("span",{class:"token number"},"0"),l("      "),c("span",{class:"token number"},"0"),l("        "),c("span",{class:"token number"},"0"),l(" eth0\n")])],-1),P=c("p",null,[l("在 Mac OSX 上，我们可以使用 "),c("code",null,"netstat"),l(" 来查看具体的路由表")],-1),C=c("pre",{class:"language-bash"},[c("code",{class:"language-bash"},[l("$ "),c("span",{class:"token function"},"netstat"),l(" -rn\n")])],-1),N=c("h2",{id:"redis-connect"},[c("a",{class:"header-anchor",href:"#redis-connect","aria-hidden":"true"},"#"),l(" redis connect")],-1),U=c("p",null,"查看 redis 的服务是否正常 ping 通",-1),A=c("pre",{class:"language-bash"},[c("code",{class:"language-bash"},[l("$ telnet xxxx "),c("span",{class:"token number"},"6379"),l("\n")])],-1),D=c("h2",{id:"caddy"},[c("a",{class:"header-anchor",href:"#caddy","aria-hidden":"true"},"#"),l(" Caddy")],-1),J=c("h4",{id:"重载配置"},[c("a",{class:"header-anchor",href:"#重载配置","aria-hidden":"true"},"#"),l(" 重载配置")],-1),M=c("pre",{class:"language-bash"},[c("code",{class:"language-bash"},"$ systemctl reload caddy\n")],-1),O=c("h4",{id:"查看日志"},[c("a",{class:"header-anchor",href:"#查看日志","aria-hidden":"true"},"#"),l(" 查看日志")],-1),j=c("pre",{class:"language-bash"},[c("code",{class:"language-bash"},"$ journalctl --no-pager -u caddy\n")],-1),E=c("h4",{id:"查看状态"},[c("a",{class:"header-anchor",href:"#查看状态","aria-hidden":"true"},"#"),l(" 查看状态")],-1),I=c("pre",{class:"language-bash"},[c("code",{class:"language-bash"},"$ systemctl status caddy\n")],-1),S=c("h4",{id:"caddy-证书位置"},[c("a",{class:"header-anchor",href:"#caddy-证书位置","aria-hidden":"true"},"#"),l(" caddy 证书位置")],-1),G=c("pre",{class:"language-bash"},[c("code",{class:"language-bash"},[l("$ "),c("span",{class:"token builtin class-name"},"cd"),l(" /var/lib/caddy/.local/share/caddy/certificates/acme-v02.api.letsencrypt.org-directory/\n$ "),c("span",{class:"token function"},"ls"),l("\nxxx.key  xxx.crt\n")])],-1),H=c("h4",{id:"caddy-trust"},[c("a",{class:"header-anchor",href:"#caddy-trust","aria-hidden":"true"},"#"),l(" caddy trust")],-1),R=c("p",null,"当出现如下日志时：",-1),X=c("pre",{class:"language-bash"},[c("code",{class:"language-bash"},[l("Jul "),c("span",{class:"token number"},"19"),l(),c("span",{class:"token number"},"20"),l(":59:32 ubuntu-vm sudo"),c("span",{class:"token punctuation"},"["),c("span",{class:"token number"},"10043"),c("span",{class:"token punctuation"},"]"),l(": pam_unix"),c("span",{class:"token punctuation"},"("),l("sudo:auth"),c("span",{class:"token punctuation"},")"),l(": conversation failed\nJul "),c("span",{class:"token number"},"19"),l(),c("span",{class:"token number"},"20"),l(":59:32 ubuntu-vm sudo"),c("span",{class:"token punctuation"},"["),c("span",{class:"token number"},"10043"),c("span",{class:"token punctuation"},"]"),l(": pam_unix"),c("span",{class:"token punctuation"},"("),l("sudo:auth"),c("span",{class:"token punctuation"},")"),l(": auth could not identify password "),c("span",{class:"token keyword"},"for"),l(),c("span",{class:"token punctuation"},"["),l("caddy"),c("span",{class:"token punctuation"},"]"),l("\nJul "),c("span",{class:"token number"},"19"),l(),c("span",{class:"token number"},"20"),l(":59:32 ubuntu-vm sudo"),c("span",{class:"token punctuation"},"["),c("span",{class:"token number"},"10043"),c("span",{class:"token punctuation"},"]"),l(":    caddy "),c("span",{class:"token builtin class-name"},":"),l(" user NOT "),c("span",{class:"token keyword"},"in"),l(" sudoers "),c("span",{class:"token punctuation"},";"),l(),c("span",{class:"token assign-left variable"},"TTY"),c("span",{class:"token operator"},"="),l("unknown "),c("span",{class:"token punctuation"},";"),l(),c("span",{class:"token assign-left variable"},[c("span",{class:"token environment constant"},"PWD")]),c("span",{class:"token operator"},"="),l("/ "),c("span",{class:"token punctuation"},";"),l(),c("span",{class:"token assign-left variable"},[c("span",{class:"token environment constant"},"USER")]),c("span",{class:"token operator"},"="),l("root "),c("span",{class:"token punctuation"},";"),l(),c("span",{class:"token assign-left variable"},"COMMAND"),c("span",{class:"token operator"},"="),l("/usr/bin/tee /usr/local/share/ca-certificates/Caddy_Local_Authority_-_2021_ECC_Root_158313951851744774645843564988098209363.crt\n")])],-1),Z=c("p",null,"可以使用如下方式添加信任：",-1),q=c("pre",{class:"language-bash"},[c("code",{class:"language-bash"},[l("$ "),c("span",{class:"token function"},"sudo"),l(),c("span",{class:"token assign-left variable"},[c("span",{class:"token environment constant"},"HOME")]),c("span",{class:"token operator"},"="),l("~caddy caddy trust\n")])],-1),B={expose:[],setup(l){const B={title:"Linux Network",date:"2021-12-28T00:00:00.000Z",author:"Linkang Chan",twitter:"JessEisen_LJ",description:"network releated things",public:!0,tag:"21Z12 network",meta:[{property:"og:title",content:"Linux Network"},{property:"og:description",content:"network releated things"},{name:"description",content:"network releated things"}]};return s({title:"Linux Network",meta:[{property:"og:title",content:"Linux Network"},{property:"og:description",content:"network releated things"},{name:"description",content:"network releated things"}]}),(s,l)=>{const F=n,K=a;return e(),t(K,{frontmatter:B},{default:o((()=>[c("div",null,[p,r,u,i,k,d,h,b,c(F,{text:"命令的详细解释",url:"https://stackoverflow.com/a/11781000/4168837"}),g,m,f,y,x,w,v,$,c("p",null,[c(F,{text:"Bring down and delete bridge interface that's up",url:"https://unix.stackexchange.com/questions/31763/bring-down-and-delete-bridge-interface-thats-up"},{default:o((()=>[_])),_:1})]),T,L,P,C,N,U,A,D,J,M,O,j,E,I,S,G,H,R,X,Z,q])])),_:1})}}};export default B;
