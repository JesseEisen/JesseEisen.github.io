import{_ as n}from"./app.2432b84d.js";import{h as a,o as t,a as s,w as o,b as p,k as e}from"./vendor.5a394a79.js";const c=p("div",null,[p("p",null,"最近简单使用了下 Python 版本的 gRpc， 对使用过程中的一些问题和经验做一些总结。"),p("h2",{id:"环境准备"},[p("a",{class:"header-anchor",href:"#环境准备","aria-hidden":"true"},"#"),e(" 环境准备")]),p("pre",{class:"language-bash"},[p("code",{class:"language-bash"},[e("$ python -m pip "),p("span",{class:"token function"},"install"),e(" grpcio\n$ python -m pip "),p("span",{class:"token function"},"install"),e(" grpcio-tools\n"),p("span",{class:"token comment"},"# 编译 proto"),e("\n$ python -m grpc_tools.protoc -I./protos --python_out"),p("span",{class:"token operator"},"="),e(". --grpc_python_out"),p("span",{class:"token operator"},"="),e(". ./protos/*.proto\n")])]),p("h2",{id:"protobuf-定义"},[p("a",{class:"header-anchor",href:"#protobuf-定义","aria-hidden":"true"},"#"),e(" protobuf 定义")]),p("h3",{id:"定义空消息"},[p("a",{class:"header-anchor",href:"#定义空消息","aria-hidden":"true"},"#"),e(" 定义空消息")]),p("pre",{class:"language-python"},[p("code",{class:"language-python"},[p("span",{class:"token keyword"},"import"),e(),p("span",{class:"token string"},'"google/protobuf/empty.proto"'),p("span",{class:"token punctuation"},";"),e("\n\nservice EmptyService "),p("span",{class:"token punctuation"},"{"),e("\n    rpc ServiceCheck"),p("span",{class:"token punctuation"},"("),e("google"),p("span",{class:"token punctuation"},"."),e("protobuf"),p("span",{class:"token punctuation"},"."),e("Empty"),p("span",{class:"token punctuation"},")"),e(" returns "),p("span",{class:"token punctuation"},"("),e("google"),p("span",{class:"token punctuation"},"."),e("protobuf"),p("span",{class:"token punctuation"},"."),e("Empty"),p("span",{class:"token punctuation"},")"),e(),p("span",{class:"token punctuation"},"{"),p("span",{class:"token punctuation"},"}"),p("span",{class:"token punctuation"},";"),e("\n"),p("span",{class:"token punctuation"},"}"),e("\n")])]),p("p",null,"这个编译后，在使用时我们可以在代码中使用："),p("pre",{class:"language-python"},[p("code",{class:"language-python"},[p("span",{class:"token keyword"},"from"),e(" google"),p("span",{class:"token punctuation"},"."),e("protobuf "),p("span",{class:"token keyword"},"import"),e(" empty_pb2\n\n"),p("span",{class:"token punctuation"},"."),p("span",{class:"token punctuation"},"."),p("span",{class:"token punctuation"},"."),e("\nstub"),p("span",{class:"token punctuation"},"."),e("ServiceCheck"),p("span",{class:"token punctuation"},"("),e("empty_pb2"),p("span",{class:"token punctuation"},"."),e("Empty"),p("span",{class:"token punctuation"},"("),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},")"),e("\n"),p("span",{class:"token punctuation"},"."),p("span",{class:"token punctuation"},"."),p("span",{class:"token punctuation"},"."),e("\n")])]),p("h3",{id:"定义二维数组"},[p("a",{class:"header-anchor",href:"#定义二维数组","aria-hidden":"true"},"#"),e(" 定义二维数组")]),p("p",null,"protobuf 在定义多维数组时，会比较笨拙，需要一层一层的定义，比如二维数组的定义："),p("pre",{class:"language-python"},[p("code",{class:"language-python"},[e("message Array2D "),p("span",{class:"token punctuation"},"{"),e("\n    message Array "),p("span",{class:"token punctuation"},"{"),e("\n        repeated int32 array "),p("span",{class:"token operator"},"="),e(),p("span",{class:"token number"},"1"),p("span",{class:"token punctuation"},";"),e("\n    "),p("span",{class:"token punctuation"},"}"),e("\n    repeated Array array2d "),p("span",{class:"token operator"},"="),e(),p("span",{class:"token number"},"1"),p("span",{class:"token punctuation"},";"),e("\n"),p("span",{class:"token punctuation"},"}"),e("\n")])]),p("p",null,"这在使用的时候我们需要做如下操作，比如："),p("pre",{class:"language-python"},[p("code",{class:"language-python"},[e("array2d "),p("span",{class:"token operator"},"="),e(" Array2D"),p("span",{class:"token punctuation"},"("),p("span",{class:"token punctuation"},")"),e("\ndata "),p("span",{class:"token operator"},"="),e(" array2d"),p("span",{class:"token punctuation"},"."),e("array2d"),p("span",{class:"token punctuation"},"."),e("add"),p("span",{class:"token punctuation"},"("),p("span",{class:"token punctuation"},")"),e("\ndata"),p("span",{class:"token punctuation"},"."),e("array"),p("span",{class:"token punctuation"},"."),e("extend"),p("span",{class:"token punctuation"},"("),p("span",{class:"token punctuation"},"["),p("span",{class:"token number"},"1"),p("span",{class:"token punctuation"},","),e(),p("span",{class:"token number"},"2"),p("span",{class:"token punctuation"},","),e(),p("span",{class:"token number"},"3"),p("span",{class:"token punctuation"},"]"),p("span",{class:"token punctuation"},")"),e("\n\n"),p("span",{class:"token comment"},"# 这将生成 [[1,2,3]]"),e("\n")])])],-1),u={expose:[],setup(p){const e={title:"gRpc In Python",date:"2021-12-23T00:00:00.000Z",author:"Linkang Chan",twitter:"JessEisen_LJ",description:"grpc releated things",public:!0,tag:"21Z07 grpc",meta:[{property:"og:title",content:"gRpc In Python"},{property:"og:description",content:"grpc releated things"},{name:"description",content:"grpc releated things"}]};return a({title:"gRpc In Python",meta:[{property:"og:title",content:"gRpc In Python"},{property:"og:description",content:"grpc releated things"},{name:"description",content:"grpc releated things"}]}),(a,p)=>{const u=n;return t(),s(u,{frontmatter:e},{default:o((()=>[c])),_:1})}}};export default u;
