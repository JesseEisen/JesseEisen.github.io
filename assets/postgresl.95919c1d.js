import{_ as s}from"./Comment.9d697db2.js";import{_ as n}from"./LinkItem.c8df38c8.js";import{_ as a}from"./app.2432b84d.js";import{h as e,o,a as t,w as l,b as p,k as c}from"./vendor.5a394a79.js";const r=p("p",null,"postgresql 是一款开源的对象关系数据库管理系统。pg 可以说是一款全栈的数据库，毕竟 slogan 是 “世界上最先进的关系型数据库”。同时 pg 比 mysql 少不少的坑，使用上会舒心一些。 本文主要是记录 pg 的使用方式，同时也会记录一些 sql 的语句或者 pg 独有的一些操作。",-1),k=p("h3",{id:"ⅰ-创建用户"},[p("a",{class:"header-anchor",href:"#ⅰ-创建用户","aria-hidden":"true"},"#"),c(" Ⅰ 创建用户")],-1),u=p("p",null,[c("pg 安装后默认会有一个 "),p("code",null,"postgres"),c(" 的用户，要创建新用户，需要先切换到该账户，然后执行如下的操作。")],-1),d=p("pre",{class:"language-sql"},[p("code",{class:"language-sql"},[c("$ su "),p("span",{class:"token operator"},"-"),c(" postgres\n"),p("span",{class:"token operator"},"-"),c("bash"),p("span",{class:"token operator"},"-"),p("span",{class:"token number"},"4.2"),c("$ psql\npostgre"),p("span",{class:"token operator"},"="),p("span",{class:"token comment"},"# create user username with password 'xxxxx';"),c("\npostgre"),p("span",{class:"token operator"},"="),p("span",{class:"token comment"},"# create database databaseName owner username;"),c("\npostgre"),p("span",{class:"token operator"},"="),p("span",{class:"token comment"},"# grant all privileges on database databaseName to username;"),c("\n")])],-1),i=p("h3",{id:"ⅱ-登录数据库"},[p("a",{class:"header-anchor",href:"#ⅱ-登录数据库","aria-hidden":"true"},"#"),c(" Ⅱ 登录数据库")],-1),m=p("p",null,"使用用户名密码登录：",-1),g=p("pre",{class:"language-sql"},[p("code",{class:"language-sql"},[c("$ psql "),p("span",{class:"token operator"},"-"),c("h hosturl "),p("span",{class:"token operator"},"-"),c("U username "),p("span",{class:"token operator"},"-"),c("d databasename "),p("span",{class:"token operator"},"-"),c("p port\n")])],-1),w=p("p",null,[p("strong",null,"注意"),c(" 在一些编程的库中使用上面的方式可能会报 "),p("code",null,"sslmode required not support"),c(" 。通过增加 "),p("code",null,"sslmode=disable"),c(" 可以解决。")],-1),y=p("h3",{id:"ⅲ-导入导出"},[p("a",{class:"header-anchor",href:"#ⅲ-导入导出","aria-hidden":"true"},"#"),c(" Ⅲ 导入导出")],-1),h=p("p",null,"可以通过一些外部命令将 pg 数据库中的内容导出到一个 sql 文件中，同时也可以将这个 sql 文件重新应用到另外的数据库中。操作如下：",-1),T=p("pre",{class:"language-sql"},[p("code",{class:"language-sql"},[p("span",{class:"token comment"},"# export to dump.sql"),c("\n$ pg_dump "),p("span",{class:"token operator"},"-"),c("h hosturl "),p("span",{class:"token operator"},"-"),c("U username databasename "),p("span",{class:"token operator"},">"),c(),p("span",{class:"token operator"},"/"),c("path"),p("span",{class:"token operator"},"/"),c("tp"),p("span",{class:"token operator"},"/"),p("span",{class:"token keyword"},"save"),p("span",{class:"token operator"},"/"),p("span",{class:"token keyword"},"dump"),p("span",{class:"token punctuation"},"."),p("span",{class:"token keyword"},"sql"),c("\n\n"),p("span",{class:"token comment"},"# import to new database "),c("\n$ psql "),p("span",{class:"token operator"},"-"),c("h hosturl "),p("span",{class:"token operator"},"-"),c("d "),p("span",{class:"token keyword"},"database"),c(),p("span",{class:"token operator"},"-"),c("U username "),p("span",{class:"token operator"},"-"),c("f "),p("span",{class:"token keyword"},"dump"),p("span",{class:"token punctuation"},"."),p("span",{class:"token keyword"},"sql"),c("\n")])],-1),q=p("p",null,"此外导出单独一个表的操作如下：",-1),L=p("pre",{class:"language-sql"},[p("code",{class:"language-sql"},[c("pg_dump "),p("span",{class:"token operator"},"-"),c("h localhost "),p("span",{class:"token operator"},"-"),c("p "),p("span",{class:"token number"},"5432"),c(),p("span",{class:"token operator"},"-"),c("U username "),p("span",{class:"token comment"},"--format plain --verbose \\"),c("\n   "),p("span",{class:"token comment"},"--file dump.sql --table public.tablename dbname"),c("\n")])],-1),b=c("不过从高版本导出后，再导入到低版本时会有一些小错误。"),E=p("strong",null,[c("一般可以通过 "),p("code",null,"sed"),c(" 将对应的行注释掉。")],-1),_=p("h3",{id:"ⅳ-插入数据"},[p("a",{class:"header-anchor",href:"#ⅳ-插入数据","aria-hidden":"true"},"#"),c(" Ⅳ 插入数据")],-1),A=p("p",null,"values 可以指定多个，批量插入。",-1),f=p("pre",{class:"language-sql"},[p("code",{class:"language-sql"},[p("span",{class:"token keyword"},"insert"),c(),p("span",{class:"token keyword"},"into"),c(" table_name "),p("span",{class:"token punctuation"},"("),c("column1"),p("span",{class:"token punctuation"},","),c(" column2"),p("span",{class:"token punctuation"},","),c(" column3"),p("span",{class:"token punctuation"},")"),c(),p("span",{class:"token keyword"},"values"),c(),p("span",{class:"token punctuation"},"("),c("value1"),p("span",{class:"token punctuation"},","),c(" value2"),p("span",{class:"token punctuation"},","),c(" value3"),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},"["),p("span",{class:"token punctuation"},","),p("span",{class:"token punctuation"},"("),p("span",{class:"token punctuation"},","),p("span",{class:"token punctuation"},"."),p("span",{class:"token punctuation"},"."),p("span",{class:"token punctuation"},"."),p("span",{class:"token punctuation"},")"),p("span",{class:"token punctuation"},"]"),p("span",{class:"token punctuation"},";"),c("\n")])],-1),N=p("h3",{id:"ⅴ-更新数据"},[p("a",{class:"header-anchor",href:"#ⅴ-更新数据","aria-hidden":"true"},"#"),c(" Ⅴ 更新数据")],-1),R=p("pre",{class:"language-sql"},[p("code",{class:"language-sql"},[p("span",{class:"token keyword"},"UPDATE"),c(" table_name\n"),p("span",{class:"token keyword"},"SET"),c(" column1 "),p("span",{class:"token operator"},"="),c(" value1"),p("span",{class:"token punctuation"},","),c(" column2 "),p("span",{class:"token operator"},"="),c(" value2"),p("span",{class:"token punctuation"},"."),p("span",{class:"token punctuation"},"."),p("span",{class:"token punctuation"},"."),p("span",{class:"token punctuation"},"."),p("span",{class:"token punctuation"},","),c(" columnN "),p("span",{class:"token operator"},"="),c(" valueN\n"),p("span",{class:"token keyword"},"WHERE"),c(),p("span",{class:"token punctuation"},"["),c("condition"),p("span",{class:"token punctuation"},"]"),p("span",{class:"token punctuation"},";"),c("\n"),p("span",{class:"token keyword"},"RETURNING"),c(),p("span",{class:"token operator"},"*"),c(),p("span",{class:"token operator"},"|"),c(" output_expression "),p("span",{class:"token keyword"},"AS"),c(" output_name"),p("span",{class:"token punctuation"},";"),c("\n")])],-1),O=p("p",null,[p("code",null,"RETURNING"),c(" 表示返回更新后符合条件的记录")],-1),U=p("h3",{id:"ⅵ-修改表格字段"},[p("a",{class:"header-anchor",href:"#ⅵ-修改表格字段","aria-hidden":"true"},"#"),c(" Ⅵ 修改表格字段")],-1),v=p("pre",{class:"language-sql"},[p("code",{class:"language-sql"},[p("span",{class:"token comment"},"# 增加字段"),c("\n"),p("span",{class:"token keyword"},"ALTER"),c(),p("span",{class:"token keyword"},"TABLE"),c(" table_name \n"),p("span",{class:"token keyword"},"ADD"),c(),p("span",{class:"token keyword"},"COLUMN"),c(" column_name datatype column_constraint"),p("span",{class:"token punctuation"},";"),c("\n\n"),p("span",{class:"token comment"},"# 删除字段"),c("\n"),p("span",{class:"token keyword"},"ALTER"),c(),p("span",{class:"token keyword"},"TABLE"),c(" table_name \n"),p("span",{class:"token keyword"},"DROP"),c(),p("span",{class:"token keyword"},"COLUMN"),c(" column_name"),p("span",{class:"token punctuation"},";"),c("\n\n"),p("span",{class:"token comment"},"# 重命名字段"),c("\n"),p("span",{class:"token keyword"},"ALTER"),c(),p("span",{class:"token keyword"},"TABLE"),c(" table_name \n"),p("span",{class:"token keyword"},"RENAME"),c(),p("span",{class:"token keyword"},"COLUMN"),c(" column_name \n"),p("span",{class:"token keyword"},"TO"),c(" new_column_name"),p("span",{class:"token punctuation"},";"),c("\n\n"),p("span",{class:"token comment"},"# 改变默认值"),c("\n"),p("span",{class:"token keyword"},"ALTER"),c(),p("span",{class:"token keyword"},"TABLE"),c(" table_name \n"),p("span",{class:"token keyword"},"ALTER"),c(),p("span",{class:"token keyword"},"COLUMN"),c(" column_name \n"),p("span",{class:"token punctuation"},"["),p("span",{class:"token keyword"},"SET"),c(),p("span",{class:"token keyword"},"DEFAULT"),c(),p("span",{class:"token keyword"},"value"),c(),p("span",{class:"token operator"},"|"),c(),p("span",{class:"token keyword"},"DROP"),c(),p("span",{class:"token keyword"},"DEFAULT"),p("span",{class:"token punctuation"},"]"),p("span",{class:"token punctuation"},";"),c("\n\n"),p("span",{class:"token comment"},"# 修改 not null 限制"),c("\n"),p("span",{class:"token keyword"},"ALTER"),c(),p("span",{class:"token keyword"},"TABLE"),c(" table_name \n"),p("span",{class:"token keyword"},"ALTER"),c(),p("span",{class:"token keyword"},"COLUMN"),c(" column_name \n"),p("span",{class:"token punctuation"},"["),p("span",{class:"token keyword"},"SET"),c(),p("span",{class:"token operator"},"NOT"),c(),p("span",{class:"token boolean"},"NULL"),p("span",{class:"token operator"},"|"),c(),p("span",{class:"token keyword"},"DROP"),c(),p("span",{class:"token operator"},"NOT"),c(),p("span",{class:"token boolean"},"NULL"),p("span",{class:"token punctuation"},"]"),p("span",{class:"token punctuation"},";"),c("\n\n"),p("span",{class:"token comment"},"# 增加check限制"),c("\n"),p("span",{class:"token keyword"},"ALTER"),c(),p("span",{class:"token keyword"},"TABLE"),c(" table_name \n"),p("span",{class:"token keyword"},"ADD"),c(),p("span",{class:"token keyword"},"CONSTRAINT"),c(" constraint_name constraint_definition"),p("span",{class:"token punctuation"},";"),c("\n\n"),p("span",{class:"token comment"},"# 增加其他限制"),c("\n"),p("span",{class:"token keyword"},"ALTER"),c(),p("span",{class:"token keyword"},"TABLE"),c(" table_name \n"),p("span",{class:"token keyword"},"ADD"),c(),p("span",{class:"token keyword"},"CONSTRAINT"),c(" constraint_name constraint_definition"),p("span",{class:"token punctuation"},";"),c("\n\n"),p("span",{class:"token comment"},"# 重命名表"),c("\n"),p("span",{class:"token keyword"},"ALTER"),c(),p("span",{class:"token keyword"},"TABLE"),c(" table_name \n"),p("span",{class:"token keyword"},"RENAME"),c(),p("span",{class:"token keyword"},"TO"),c(" new_table_name"),p("span",{class:"token punctuation"},";"),c("\n")])],-1),D=p("h3",{id:"导出查询内容到文件"},[p("a",{class:"header-anchor",href:"#导出查询内容到文件","aria-hidden":"true"},"#"),c(" 导出查询内容到文件")],-1),S=p("p",null,[c("一般先切换对应的用户，比如 "),p("code",null,"su postgres"),c("。 之后可以执行如下的命令：")],-1),C=p("pre",{class:"language-sql"},[p("code",{class:"language-sql"},[c("psql "),p("span",{class:"token operator"},"-"),c("d models "),p("span",{class:"token operator"},"-"),c("c "),p("span",{class:"token string"},'"COPY (select * from tblname) TO STDOUT WITH CSV HEADER"'),c(),p("span",{class:"token operator"},">"),c(" a"),p("span",{class:"token punctuation"},"."),c("csv\n")])],-1),x=c(" 多种方式执行查询导出 "),I={expose:[],setup(c){const I={title:"PostgreSQL In Action",date:"2021-01-25T00:00:00.000Z",author:"Linkang Chan",twitter:"JessEisen_LJ",description:"postgresql",public:!0,tag:"21B12 postgresql",meta:[{property:"og:title",content:"PostgreSQL In Action"},{property:"og:description",content:"postgresql"},{name:"description",content:"postgresql"}]};return e({title:"PostgreSQL In Action",meta:[{property:"og:title",content:"PostgreSQL In Action"},{property:"og:description",content:"postgresql"},{name:"description",content:"postgresql"}]}),(e,c)=>{const B=s,P=n,M=a;return o(),t(M,{frontmatter:I},{default:l((()=>[p("div",null,[r,k,u,d,i,m,g,w,y,h,T,q,L,p("p",null,[p(B,null,{default:l((()=>[b,E])),_:1})]),_,A,f,N,R,O,U,v,D,S,C,p("p",null,[p(P,{text:"参考回答",url:"https://stackoverflow.com/a/49992062/4168837"},{default:l((()=>[x])),_:1})])])])),_:1})}}};export default I;
