<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>
      21B07 | Chan
    </title>
    <meta name="description" content="A PKM Site">
    <link rel="stylesheet" href="/assets/style.9094c090.css">
    <link rel="modulepreload" href="/assets/framework.ab59a038.js">
    <link rel="modulepreload" href="/assets/daily_21B07.md.72f1455d.lean.js">
    <link rel="modulepreload" href="/assets/app.0e5b1c46.js">
    
    
  </head>
  <body>
    <div id="app"><div><main class="max-w-4xl mx-auto px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="pt-6 pb-8 space-y-2 md:space-y-5"><h3 class="text-xl leading-9 font-extrabold text-gray-900 tracking-tight sm:leading-10 md:leading-14"><a aria-label="Chan" href="/">Chan</a></h3></div><article class="xl:divide-y xl:divide-gray-200" data-v-f48e88ee><header class="pt-6 xl:pb-10 space-y-1 text-center" data-v-f48e88ee><h3 class="text-xl leading-9 font-bold text-gray-900 tracking-tigh" data-v-f48e88ee>21B07 - python hard way</h3></header><div class="prose max-w-none pt-10 pb-8" data-v-f48e88ee><p><div class="table-of-contents"><ul><li><a href="#command-line-argument-parse">command line argument parse</a></li><li><a href="#progess-bar">Progess Bar</a></li></ul></div></p><hr><h2 id="command-line-argument-parse"><a class="header-anchor" href="#command-line-argument-parse" aria-hidden="true">#</a> command line argument parse</h2><p>使用 [<a href="https://click.palletsprojects.com/en/7.x/" target="_blank" rel="noopener noreferrer">click</a>] 作为解析库，可以方便的实现子命令操作。整理一些使用中遇到的问题。</p><ul><li>对 argument 进行注释</li></ul><p>使用多行注释的方式 <code>&quot;&quot;&quot; xxx &quot;&quot;&quot;</code>。但是 click 默认是现在在统一行，去除掉了换行的操作。所以在有多参数的情况下显示比较乱。解决方式是：</p><div class="language-"><pre><code>@click.command()
@click.argument(&#39;gt&#39;, type=click.Path(exists=True))
@click.argument(&#39;prefix&#39;, type=click.Path(exists=True))
def execute(gt, prefix):
    &quot;&quot;&quot;
       \b 
       explain the command usage
       gt: xxxx
       prefix: xxxxx
    &quot;&quot;&quot;
</code></pre></div><h2 id="progess-bar"><a class="header-anchor" href="#progess-bar" aria-hidden="true">#</a> Progess Bar</h2><p>使用 <a href="https://tqdm.github.io/docs/cli/" target="_blank" rel="noopener noreferrer">tqdm</a> 搭配各种场景使用，比如在 requests 中显示现在的进度时，可以有如下的方式：</p><div class="language-python"><pre><code>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> stream<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment"># status code check </span>
path <span class="token operator">=</span> pathlib<span class="token punctuation">.</span>Path<span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">.</span>expanduser<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>resolve<span class="token punctuation">(</span><span class="token punctuation">)</span>
path<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>parents<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

desc <span class="token operator">=</span> filename<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token string">&#39; &#39;</span><span class="token punctuation">)</span> <span class="token comment"># 22 is the lenght bigger than filename, should change</span>
r<span class="token punctuation">.</span>raw<span class="token punctuation">.</span>read <span class="token operator">=</span> functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span>r<span class="token punctuation">.</span>raw<span class="token punctuation">.</span>read<span class="token punctuation">,</span> decode_content<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># Decompress if needed</span>
<span class="token keyword">with</span> tqdm<span class="token punctuation">.</span>tqdm<span class="token punctuation">.</span>wrapattr<span class="token punctuation">(</span>r<span class="token punctuation">.</span>raw<span class="token punctuation">,</span> <span class="token string">&quot;read&quot;</span><span class="token punctuation">,</span> total<span class="token operator">=</span>file_size<span class="token punctuation">,</span> desc<span class="token operator">=</span>desc<span class="token punctuation">)</span> <span class="token keyword">as</span> r_raw<span class="token punctuation">:</span>
     <span class="token keyword">with</span> path<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;wb&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            shutil<span class="token punctuation">.</span>copyfileobj<span class="token punctuation">(</span>r_raw<span class="token punctuation">,</span> f<span class="token punctuation">)</span>
</code></pre></div></div></article></main></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"4ba7c645\",\"daily_21b04.md\":\"7c3783e8\",\"daily_21b05.md\":\"cb63fc78\",\"daily_21b06.md\":\"c8b15d5d\",\"daily_21b07.md\":\"72f1455d\",\"posts_first_post.md\":\"1eb64573\"}")</script>
    <script type="module" async src="/assets/app.0e5b1c46.js"></script>
  </body>
</html>