---
layout: post
title: Sed Command OverView
date: 2018-05-27 18:00:00
description: sed
---

sed æ˜¯ä¸€ä¸ªæµç¼–è¾‘å™¨ï¼Œå¯ä»¥ç”¨æ¥æ“ä½œæ–‡æœ¬çš„ä¸€äº›å˜æ¢ã€‚åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯ä»¥ä½œå‡ºæ›´åŠ é«˜æ•ˆçš„æ“ä½œã€‚

### ä¸€ã€å‘½ä»¤è¡Œä½¿ç”¨

sed çš„é€šç”¨è°ƒç”¨æ–¹å¼æ˜¯ï¼š

```shell
sed SCRIPT INPUTFILES...
```

SCRIPT éƒ¨åˆ†å¯ä»¥æ˜¯ä¸€ä¸ªè„šæœ¬æ–‡ä»¶æˆ–è€…ç›´æ¥ç”¨å•å¼•å·æ‰©èµ·æ¥çš„ç®€å•å‘½ä»¤, INPUTFILES æ˜¯è¾“å…¥çš„æ–‡ä»¶ã€‚

```shell
# å°† input file ä¸­çš„ hello æ›¿æ¢æˆ world
sed 's/hello/world/' input.txt 
# æŒ‡å®šæ‰§è¡Œ script.sed
sed -f script.sed input.txt
# sed ä¼šå°†å¤šä¸ªæ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªæ–‡ä»¶ï¼›
# ä¸‹é¢çš„å‘½ä»¤ä¼šè¾“å‡ºç¬¬ä¸€ä¸ªæ–‡ä»¶çš„ç¬¬ä¸€è¡Œå’Œç¬¬äºŒä¸ªæ–‡ä»¶çš„æœ€åä¸€è¡Œ
sed -n '1p;$p' inputfile1.txt inputfile2.txt
# - è¡¨ç¤ºä»æ ‡å‡†è¾“å…¥è¯»å–å†…å®¹
cat input.txt | sed 's/hello/world/' - 
```

ä¸€ä¸ªä¸å¾—ä¸æçš„å‘½ä»¤è¡Œé€‰é¡¹ `-i`. å¦‚æœæƒ³å°† sed çš„è¾“å‡ºç›´æ¥å†™å…¥åˆ°å½“å‰çš„æ–‡ä»¶é‡Œã€‚å‡ºç°åœ¨æˆ‘ä»¬è„‘æµ·ä¸­å°±æ˜¯ä½¿ç”¨é‡å®šå‘å°±å¯ä»¥äº†ï¼Œ**å®é™…ä¸Šè¿™æ˜¯ä¸€ä¸ªéå¸¸å±é™©çš„æ“ä½œ**ã€‚ å¦‚æœä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š

```shell
# âš ï¸ å±é™©å‘½ä»¤ï¼Œå‹¿ç”¨
sed 's/hello/world' input.txt > input.txt
```

å¾—åˆ°çš„ç»“æœå°±æ˜¯ input.txt çš„å†…å®¹è¢«æ¸…ç©ºã€‚æ˜¾ç„¶è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚æ­£ç¡®çš„æ“ä½œæ–¹å¼æ˜¯ä½¿ç”¨ `-i` é€‰é¡¹ï¼Œå¯ä»¥ç›´æ¥å°†ä¿®æ”¹çš„å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬å¹¶ä¸ä¸€å®šèƒ½ä¿è¯æ“ä½œèƒ½å¤Ÿä¸€æ¬¡æˆåŠŸï¼Œè¯¥é€‰é¡¹è¿˜æä¾›äº†ä¸€ä¸ªå¤‡ä»½çš„åŠŸèƒ½ï¼Œå¦‚ä¸‹ï¼š

```shell
$ sed -iback '...' input
# æœ€ç»ˆä¼šç”Ÿæˆ inputback è¿™ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åˆ™æ˜¯ input æ–‡ä»¶çš„å¤‡ä»½ã€‚ä¸€ä¸ªå®¹é”™çš„æœºåˆ¶ã€‚
```

æ­¤å¤–è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯ä¸è¦å°† `-n` å’Œ `-i` åˆå¹¶ä½¿ç”¨ï¼Œè¿™æ ·æ–‡ä»¶åŒæ ·ä¼šè¢«æˆªæ–­ï¼Œä¸ä¼šæœ‰ä»»ä½•çš„è¾“å‡ºåˆ°æ–‡ä»¶ã€‚

sed å‘½ä»¤è¡Œä¼šè¿”å›ä¸€äº›é€€å‡ºç ï¼Œå¯ä»¥æ ¹æ®é€€å‡ºç ç®€å•åˆ¤æ–­ä¸€ä¸‹é”™è¯¯çš„åŸå› ï¼š


### äºŒã€sed è„šæœ¬ä½¿ç”¨

sed çš„è„šæœ¬éƒ¨åˆ†å¯ä»¥ç®€å•çš„åˆ’åˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ã€‚

```shell
[addr]X[options]
```

å…¶ä¸­ X è¡¨ç¤ºçš„æ˜¯å•ä¸ªå­—ç¬¦çš„ sed å‘½ä»¤ï¼Œ`[addr]` æ˜¯å¯é€‰ï¼Œå®ƒçš„å½¢å¼å¯ä»¥æ˜¯ï¼š

+ å•ä¸ªè¡Œå·
+ æ­£åˆ™è¡¨è¾¾å¼
+ èŒƒå›´çš„è¡Œå·

`[options]` åˆ™æ˜¯ä¸€äº› sed å‘½ä»¤çš„é¢å¤–çš„å‚æ•°é€‰é¡¹ã€‚æ¯”å¦‚ï¼š

```shell
sed '/^foo/q42' input.txt
```

è¿™ä¸ªå‘½ä»¤çš„æ„æ€æ˜¯è¾“å‡ºä¸æ˜¯ä»¥ foo å¼€å¤´çš„è¡Œï¼Œå¦‚æœé‡åˆ°äº†ä»¥ foo å¼€å¤´çš„è¡Œï¼Œåˆ™é€€å‡ºï¼Œè¿”å›ç»“æœç  42ã€‚ è¿™è¾¹çš„ /^foo/ å°±æ˜¯ [addr], q è¡¨ç¤ºæ˜¯ Xï¼Œ 42 åˆ™æ˜¯ [option]ã€‚

ä¸åŒçš„å‘½ä»¤ä¹‹é—´å¯ä»¥ä½¿ç”¨ `;` åšåˆ†éš”ï¼Œæˆ–è€…æ˜¯ç”¨ `-e` é€‰é¡¹ã€‚ ä¸è¿‡æœ‰å‡ ä¸ªå‘½ä»¤ç”±äºè¯­æ³•çš„é™åˆ¶ä¸å¯ä»¥ä½¿ç”¨ `;` ä½œä¸ºåˆ†éš”ã€‚

### å››ã€s å‘½ä»¤
åœ¨ sed ä¸­ç”¨çš„æœ€å¤šçš„å°±æ˜¯ s å‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤è¡¨ç¤ºçš„æ˜¯æ›¿æ¢ã€‚å‘½ä»¤çš„è¯­æ³•å¾ˆç®€å•ï¼š`s/regexp/replacement/flags`ã€‚sed æ˜¯æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼çš„åˆ†ç»„åŠŸèƒ½çš„ã€‚ä½¿ç”¨ `\( \)` å°†åŒ¹é…çš„éƒ¨åˆ†åœ¨æ›¿æ¢éƒ¨åˆ†ç”¨`\n` è¿›è¡Œæ›¿æ¢å¼•ç”¨ã€‚æ­¤å¤–è¿˜å¯ä»¥ä½¿ç”¨ & æ¥è¡¨ç¤ºæ‰€æœ‰çš„åŒ¹é…åˆ°çš„åˆ†ç»„ã€‚

s å‘½ä»¤åŒ…å«å¾ˆå¤šçš„ flagsï¼Œæœ‰ä¸€äº›æ¯”è¾ƒå®ç”¨çš„ï¼š

|  flag       |  è§£é‡Š         |
|:-------------|:------------------|
| g | æ›¿æ¢æ‰€æœ‰åŒ¹é…åˆ°çš„å†…å®¹ |
| number | åªæ›¿æ¢ç¬¬ n ä¸ªåŒ¹é…, åŒ¹é…ä» 0th å¼€å§‹è®¡æ•°|
| p | å¦‚æœæ›¿æ¢æˆåŠŸï¼Œæ‰“å°å‡ºæ›¿æ¢åçš„ç»“æœ|


### äº”ã€ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤

+ \#  ç”¨äºæ³¨é‡Š
+ q[exit-code] æŒ‡å®šè¿”å›ç 
+ d åˆ é™¤ pattern space é‡Œé¢çš„å†…å®¹ï¼Œç«‹å³å¼€å§‹ä¸‹ä¸€ä¸ªå¾ªç¯ã€‚
+ p æ‰“å° pattern space ä¸­çš„å†…å®¹ï¼Œä¸€èˆ¬å’Œ -n é€‰é¡¹ä¸€èµ·ä½¿ç”¨
+ n é€šä¿—çš„è¯´æ˜¯è·³è¿‡å½“å‰çš„ pattern space ä¸­çš„è¡Œï¼Œæ“ä½œä¸‹ä¸€è¡Œã€‚
+ { commands } æ‰§è¡Œä¸€ç»„æ“ä½œï¼Œä¸»è¦æ˜¯ç”¨äºå¯¹æŸä¸ªåœ°å€æˆ–è€…åœ°å€èŒƒå›´è¿›è¡Œæ“ä½œçš„æƒ…å†µã€‚

ä¸‹é¢çœ‹å‡ ä¸ªä¾‹å­ï¼š

```shell
$ seq 3 | sed -n 2p
$ seq 6 | sed 'n;n;s/./x/'  # æ¯ä¸‰è¡Œæ›¿æ¢ä¸€ä¸‹
$ seq 3 | sed -n '2{s/2/X/ ; p;}' # æ›¿æ¢ç¬¬äºŒè¡Œï¼Œå¹¶åªè¾“å‡ºç¬¬äºŒè¡Œã€‚
```

### å¾ˆå°‘ä½¿ç”¨åˆ°çš„å‘½ä»¤

+ y/source_chars/dest_chars/
 
è¿™ä¸ªå‘½ä»¤å¾ˆç±»ä¼¼äº tr å‘½ä»¤ã€‚æ¯”å¦‚ï¼š

```shell
$ echo hello world | sed 'y/abcdefghij/0123456789/'
74llo worl3
```

**a\\
text**

åœ¨ä¸€è¡Œä¹‹åæ·»åŠ  textï¼Œè¿™ä¸ªå½¢å¼çš„ POSIX çš„æ”¯æŒã€‚ è€Œ GNU sed æ”¯æŒå¦å¤–ä¸¤ç§å½¢å¼: `a text` å’Œ `-e '2a\' -e text` ã€‚åè€…æ›´åˆ©äºåœ¨è„šæœ¬ä¸­ä½¿ç”¨ï¼š

```shell
$ seq 3 | sed '2a\
> hello\
> world
> 3s/./X/'
1
2
hello
world
X

# GNU sed
$ seq 3 | sed -e '2a\' -e hello
1
2
hello
3

# ä½¿ç”¨ shell è„šæœ¬ä¸­çš„å˜é‡
$ seq -e '2a\' -e "$var"
```


**i \\
text**

åœ¨æŒ‡å®šè¡Œä¹‹å‰æ’å…¥ textã€‚ æ“ä½œå’Œ a å‘½ä»¤ä¸€æ ·ï¼Œå¯¹äº GNU sed è€Œè¨€ï¼Œæ‰©å±•æ–¹å¼ä¹Ÿæ˜¯ä¸€æ ·ã€‚

**c \\
text**

ç”¨ text æ›¿æ¢æŒ‡å®šè¡Œæˆ–è€…èŒƒå›´è¡Œçš„å†…å®¹ã€‚GNU sed çš„æ‰©å±•æ–¹å¼å’Œä¸Šé¢ä¸¤ä¸ªå‘½ä»¤ä¸€æ ·ã€‚ ğŸŒ°å¦‚ä¸‹ï¼š

```shell
$ seq 10 | sed '2,9c\
> hello'
1
hello
10
```

å¦‚æœæ²¡æœ‰æŒ‡å®šè¡Œå·ï¼Œåˆ™æ¯ä¸€è¡Œéƒ½ä¼šè¢«æ›¿æ¢ã€‚

+ =

æ‰“å°å‡ºå½“å‰è¡Œçš„è¡Œå·ã€‚

+ r filename

è¯»å– filename ä¸­çš„å†…å®¹ï¼Œåœ¨å½“å‰ cycle ç»“æŸæ—¶å°†å†…å®¹è¾“å‡ºï¼Œæ¥ç€å¼€å§‹ä¸‹ä¸€ä¸ª cycleã€‚ å¦‚æœæ–‡ä»¶ä¸èƒ½è¢«æ‰“å¼€ï¼Œåˆ™è®¤ä¸ºè¿™ä¸ªæ–‡ä»¶ä¸ºç©ºï¼Œä¸ä¼šæŠ¥é”™ã€‚

+ w filename

å°†æŒ‡å®šçš„è¡Œä» pattern space ä¸­å†™å…¥æ–‡ä»¶ä¸­ï¼Œä¸è¿‡ä¸ä¼šæ¸…æ‰ pattern spaceï¼Œæ‰€ä»¥è¿˜æ˜¯ä¼šåœ¨æ ‡å‡†è¾“å‡ºä¸Šæ˜¾ç¤ºç»“æœã€‚æ³¨æ„è¿™ä¸ªå†™å…¥ä¼šè¦†ç›–æ‰ filename ä¸­åŸæœ‰çš„å†…å®¹ã€‚å°±åƒ `> filename ` ä¸€æ ·ï¼Œä¸ä¼šè¿½åŠ ã€‚

```shell
$ cat file
this is file
$ seq 3 | sed '2r./file' # file name append after line2
1
2
this is file
3
$ seq 3 | sed '2w./file' 
1
2
3
$ cat file  # only 2 in file
2
```


