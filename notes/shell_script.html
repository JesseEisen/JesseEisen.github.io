<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="referrer" content="no-referrer"><link rel="icon" href="/favicon.svg" type="image/svg+xml"><link rel="apple-touch-icon" href="/pwa-192x192.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#00aba9"><meta name="msapplication-TileColor" content="#00aba9"><meta name="theme-color" content="#ffffff"><script type="module" async="" crossorigin="" src="/assets/app.252c1e4c.js"></script><link rel="modulepreload" href="/assets/vendor.80607e96.js"><link rel="stylesheet" href="/assets/app.288c200a.css"><link rel="manifest" href="/manifest.webmanifest"><link rel="modulepreload" crossorigin="" href="/assets/shell_script.2c73d53e.js"><link rel="modulepreload" crossorigin="" href="/assets/Code.fee8bdde.js"><link rel="stylesheet" href="/assets/Code.1ebb05a2.css"><link rel="modulepreload" crossorigin="" href="/assets/ShortHR.090ec3c7.js"><link rel="stylesheet" href="/assets/ShortHR.10dbff62.css"><link rel="modulepreload" crossorigin="" href="/assets/LinkItem.65bc6d8d.js"><link rel="stylesheet" href="/assets/LinkItem.bf447482.css"><meta property="og:title" content="Bash Script Skill Notes"><meta property="og:description" content="collections of bash script skill"><meta name="description" content="collections of bash script skill"><meta name="head:count" content="3"><title>Chan93</title></head><body><div id="app" data-server-rendered="true"><div h="full" flex="~ col" p="x-4"><nav z="100" text="dark-100 dark:light-900" position="fixed top-0 left-0 right-0" bg="dark:dark-500 dark:opacity-50 white opacity-75" backdrop="~ blur-lg" h="18" p="x-4" border="b-1 dark:dark-500"><div max-w="screen-lg" m="ml-4" h="full" flex="~ row" items="center" space="x-4"><a href="/" class="" flex="1"><h1 text="2xl" font="bold">ğŸ£ WhatIf</h1></a><a href="/blogs" class=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M12 16c1.1 0 2 .9 2 2s-.9 2-2 2s-2-.9-2-2s.9-2 2-2m0-6c1.1 0 2 .9 2 2s-.9 2-2 2s-2-.9-2-2s.9-2 2-2m0-6c1.1 0 2 .9 2 2s-.9 2-2 2s-2-.9-2-2s.9-2 2-2M6 16c1.1 0 2 .9 2 2s-.9 2-2 2s-2-.9-2-2s.9-2 2-2m0-6c1.1 0 2 .9 2 2s-.9 2-2 2s-2-.9-2-2s.9-2 2-2m0-6c1.1 0 2 .9 2 2s-.9 2-2 2s-2-.9-2-2s.9-2 2-2m12 12c1.1 0 2 .9 2 2s-.9 2-2 2s-2-.9-2-2s.9-2 2-2m0-6c1.1 0 2 .9 2 2s-.9 2-2 2s-2-.9-2-2s.9-2 2-2m0-6c1.1 0 2 .9 2 2s-.9 2-2 2s-2-.9-2-2s.9-2 2-2z" fill="currentColor"></path></svg></a><a href="/notes" class=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M14.6 16.6l4.6-4.6l-4.6-4.6L16 6l6 6l-6 6l-1.4-1.4m-5.2 0L4.8 12l4.6-4.6L8 6l-6 6l6 6l1.4-1.4z" fill="currentColor"></path></svg></a><a href="/books" class=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M9 3v15h3V3H9m3 2l4 13l3-1l-4-13l-3 1M5 5v13h3V5H5M3 19v2h18v-2H3z" fill="currentColor"></path></svg></a><a href="/daily" class=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5v-5z" fill="currentColor"></path></svg></a><a href="https://github.com/jesseeisen" target="_blank" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33c.85 0 1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2z" fill="currentColor"></path></svg></a><a cursor="pointer"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg></a></div></nav><main flex="~ 1 row" justify="start" w="full" max-w="screen-lg" m="ml-4" p="t-18" text="dark:light-400 dark-300"><div data-v-610c0928=""><div data-v-610c0928=""><a flex="~ row" items="center" class="dark:text-white-900 dark:opacity-60" space="x-2" m="t-4" cursor="pointer" data-v-610c0928=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32" text="12px" data-v-610c0928=""><path d="M14 26l1.41-1.41L7.83 17H28v-2H7.83l7.58-7.59L14 6L4 16l10 10z" fill="currentColor"></path></svg><span text="12px dark:light-50 true-gray-500" font="bold" data-v-610c0928="">Back to prev</span></a></div><header text="center" border="b-1 dark:dark-200" p="y-10" data-v-610c0928=""><h1 text="36px dark:light-50 dark " font=" extrabold -.015em 48px" class="post-title" data-v-610c0928="">Bash Script Skill Notes</h1><div my="20px" data-v-610c0928=""><span text="sm dark:light-900 dark:opacity-60 #666" m="b-2" display="block" data-v-610c0928="">Jan 18, 2021</span></div><div text="left" flex="~" m="t-4" data-v-610c0928=""><div flex="~ row" items="center" space="x-2" class="mx-auto" data-v-610c0928="" data-v-22abfd34=""><img border="rounded-full" src="https://secure.gravatar.com/avatar/190aa3adff4e1451b32c354f0b5fd7f9?size=30" data-v-22abfd34=""><div flex="~ col" class="author-info" data-v-22abfd34=""><span text="500 dark:light-900 dark:opacity-80 dark-900" data-v-22abfd34="">Linkang Chan</span><br data-v-22abfd34=""><a href="https://twitter.com/JessEisen_LJ" class="text-pink-500 text-sm" target="_blank" data-v-22abfd34="">@Jesse Chan</a></div></div></div></header><div flex="~" w="60%" justify="start" data-v-610c0928=""><article m="t-8" data-v-610c0928=""><div w="90%" class="prose prose-lg" text="dark:light-900 dark:opacity-72" data-v-610c0928=""><!--[--><div><div><span><i>incoming (1):</i></span><!--[--><span><a href="/notes/command">command</a></span><!--]--></div><p>bash shell è¿™ç§å¤è€è€Œåˆå¤æ€ªçš„è¯­è¨€ï¼Œè™½ç„¶åœ¨å¤„ç†æ—¥å¸¸çš„å·¥ä½œæ—¶èƒ½å¾ˆå¤§æå‡æ•ˆç‡ï¼Œä½†æ˜¯å…¶ä¸€äº›è¯­æ³•æ˜¯çœŸçš„å¾ˆéš¾åƒå…¶ä»–è¯­è¨€ä¸€æ ·ä¿¡æ‰‹æ‹ˆæ¥çš„å°±ä½¿ç”¨ã€‚æ‰€ä»¥è¿™ç¯‡æ–‡ç« è®°å½•çš„æ˜¯æˆ‘æ—¥å¸¸å·¥ä½œä¸­ç»å¸¸å®¹æ˜“å¿˜è®°çš„éƒ¨åˆ†ã€‚</p><h2 id="ç›®å½•å’Œæ–‡ä»¶"><a class="header-anchor" href="#ç›®å½•å’Œæ–‡ä»¶" aria-hidden="true">#</a>ç›®å½•å’Œæ–‡ä»¶</h2><p>éå†ç›®å½•å’Œå¯¹ç›®å½•ä¸­çš„æ–‡ä»¶è¿›è¡Œæ“ä½œæ—¶å¾ˆå¸¸è§çš„ã€‚å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬æ·±åº¦éå†ä¸€ä¸ªç›®å½•å¯èƒ½ä¼šç”¨ä¸¤ä¸ª<code>for</code>å¾ªç¯ï¼Œä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥æœ‰å‡ ç§ä¸åŒçš„æ–¹å¼æ¥å®Œæˆè¿™äº›ä»»åŠ¡ã€‚</p><p><code class="op" data-v-46b747e9=""><!--[-->find<!--]--></code></p><pre class="language-bash"><code class="language-bash"><span class="token function">find</span> <span class="token builtin class-name">.</span>   // æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶
<span class="token function">find</span> <span class="token builtin class-name">.</span> -name <span class="token string">"*.txt"</span> -type f   //find all txt <span class="token function">file</span>
<span class="token function">find</span> <span class="token builtin class-name">.</span> -type f -name <span class="token string">"*.txt"</span> -print0 <span class="token operator">|</span> <span class="token function">xargs</span> -0 <span class="token function">fgrep</span> text
</code></pre><p><code class="op" data-v-46b747e9=""><!--[-->for<!--]--></code></p><p>æ­£å¸¸çš„æ€è·¯æ˜¯ä½¿ç”¨<code>for</code>å¾ªç¯å»éå†ï¼Œä½¿ç”¨<code>for</code>å¾ªç¯ä¹Ÿæ˜¯æœ‰ä¸€å®šçš„æŠ€å·§çš„ï¼Œæ­£å¸¸çš„æƒ…å†µæ˜¯ä½¿ç”¨ä¸€ä¸ªé€’å½’çš„æ–¹å¼éå†ç›®å½•ï¼Œä½†æ˜¯åœ¨<code>bash4</code>çš„ç‰ˆæœ¬ä¸‹ï¼Œå¯ä»¥å¼€å¯<code>globstar</code>æˆ–è€…<code>dotglob</code>è¿™ä¸¤ä¸ªé€‰é¡¹ï¼ŒåŒºåˆ«åœ¨äºæ˜¯å¦è¦åŒ¹é…éšè—çš„æ–‡ä»¶ã€‚</p><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">shopt</span> -s globstar <span class="token operator">||</span> <span class="token builtin class-name">exit</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">f</span> <span class="token keyword">in</span> **
<span class="token keyword">do</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$f</span>"</span> <span class="token operator">=</span>~ <span class="token punctuation">\</span>.txt$ <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$f</span>"</span>
	<span class="token keyword">fi</span>
<span class="token keyword">done</span>
</code></pre><p>è¿™é‡Œé¢ç”¨åˆ°äº†ä¸¤ä¸ªæŠ€å·§ï¼Œä¸€ä¸ªæ˜¯å¦‚æœä¸æ”¯æŒ<code>globstar</code>å°±é€€å‡ºè„šæœ¬æ‰§è¡Œï¼Œå¦ä¸€ä¸ªæ˜¯<code>if</code>çš„æ­£åˆ™åŠŸèƒ½æ”¯æŒã€‚è¯è¯´å›æ¥ï¼Œå¦‚æœç³»ç»Ÿä¸æ”¯æŒè¿™æ ·çš„é€‰é¡¹ï¼Œé‚£æˆ‘ä»¬åªèƒ½å›åˆ°ä¸€ä¸ªåŸå§‹çš„æ–¹å¼äº†ã€‚</p><pre class="language-bash"><code class="language-bash"><span class="token keyword">function</span> <span class="token function-name function">walk_tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token for-or-select variable">f</span> <span class="token keyword">in</span> <span class="token string">"<span class="token variable">$1</span>"</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
		<span class="token keyword">if</span> <span class="token punctuation">[</span> -d <span class="token string">"<span class="token variable">$f</span>"</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
			walk_tree <span class="token string">"<span class="token variable">$f</span>"</span>
		<span class="token keyword">else</span>
			<span class="token assign-left variable">fullpath</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>readlink -f <span class="token string">"<span class="token variable">$f</span>"</span><span class="token variable">`</span></span>
			<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$fullpath</span>"</span> <span class="token operator">=</span>~ <span class="token punctuation">\</span>.txt$ <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
				<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$fullpath</span>"</span>
			<span class="token keyword">fi</span>
	<span class="token keyword">done</span>
<span class="token punctuation">}</span>
</code></pre><p>æœ‰ä¸¤ä¸ªå¯ä»¥æ³¨æ„çš„ç‚¹æ˜¯ï¼š<code>readlink -f</code>å¯ä»¥è¾“å‡ºæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚åŒæ—¶<code>$f</code>æœ¬èº«ä¼šå¸¦æœ‰ç›¸å¯¹çš„è·¯å¾„ï¼Œæ‰€ä»¥ä¸éœ€è¦å†ä¼ è·¯å¾„ã€‚å®é™…ä¸Šå¦‚æœæƒ³è¦ä¸€è¡Œå°±è§£å†³é—®é¢˜<code>find</code>æ˜¯é¦–é€‰çš„ã€‚å…¶æ¬¡ä¸éœ€è¦ä½¿ç”¨é€’å½’ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸æ£’çš„æ–¹å¼ã€‚<code>find</code>é…åˆä¸Š<code>exec</code>å’Œ<code>xargs</code>åŒæ ·å¯ä»¥æ‰§è¡Œä¸€äº›ç®€å•çš„å‘½ä»¤ã€‚</p><div class="outer" data-v-a0e12a16=""><div class="short-hr" data-v-a0e12a16=""></div></div><h2 id="é‡å®šå‘"><a class="header-anchor" href="#é‡å®šå‘" aria-hidden="true">#</a>é‡å®šå‘</h2><p>é‡å®šå‘åœ¨ç®€å•çš„ä½¿ç”¨ä¸Šæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯æ¶‰åŠåˆ°æ–‡ä»¶æè¿°ç¬¦çš„å¤åˆ¶æ—¶ï¼Œå¾€å¾€ä¼šä¸€è„¸æ‡µã€‚æ¯•ç«Ÿæˆ‘ä»¬å¤§å¤šæ•°æ—¶é—´ä½¿ç”¨çš„æ˜¯<code>&gt;</code>,<code>&gt;&gt;</code>è¿™ä¸¤ä¸ªã€‚ä¸‹é¢æ˜¯ç®€å•çš„ä¸€äº›è®°å½•å¾ˆå¤„ç†ã€‚</p><p><strong>æè¿°ç¬¦å¤åˆ¶</strong></p><blockquote><p><code>n&gt;&amp;m</code>å°†æè¿°ç¬¦ n æŒ‡å‘ m æ‰€æŒ‡å‘çš„ä½ç½®ã€‚</p></blockquote><p>æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨<code>exec</code>æ¥æ‰§è¡Œæè¿°ç¬¦ä¹‹é—´çš„å¤åˆ¶ã€‚</p><pre class="language-shell"><code class="language-shell">$ <span class="token builtin class-name">exec</span> <span class="token number">3</span> <span class="token operator">&lt;</span> <span class="token function">file</span>
$ <span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">4</span>&gt;</span><span class="token file-descriptor important">&amp;3</span>
$ <span class="token builtin class-name">read</span> -u <span class="token number">4</span> line
$ <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$line</span>"</span>
</code></pre><p>ä¸Šé¢çš„å°†æ–‡ä»¶ file æ‰“å¼€å¹¶ç”¨æè¿°ç¬¦ 3 è¡¨ç¤ºã€‚æ¥ç€ç”¨æè¿°ç¬¦ 4 æ¥å¤åˆ¶æè¿°ç¬¦ 3ã€‚æ¥ç€ä»æè¿°ç¬¦ 4 ä¸­è¯»å–å†…å®¹ï¼Œè¿™ä¸ªå†…å®¹å°±æ˜¯ file ä¸­çš„å†…å®¹äº†ã€‚è¿™å°±è¡¨ç¤ºæ­¤æ—¶æè¿°ç¬¦ 3 å’Œæè¿°ç¬¦ 4 æŒ‡å‘äº†åŒä¸€ä¸ªä½ç½®ã€‚</p><p><strong>é‡å®šå‘é¡ºåº</strong></p><blockquote><p><code>2&gt;&amp;1 &gt;foo</code><strong>æè¿°ç¬¦ 2 å’Œ æè¿°ç¬¦ 1 æŒ‡å‘ä¸åŒçš„ä½ç½®ã€‚</strong></p><p><code>&gt;foo 2&gt;&amp;1</code><strong>æè¿°ç¬¦ 2 å’Œ æè¿°ç¬¦ 1 æŒ‡å‘ç›¸åŒçš„ä½ç½®ã€‚</strong></p></blockquote><p><strong>å…³é—­æè¿°ç¬¦</strong></p><ul><li>n&lt;&amp;- å…³é—­ä¸€ä¸ªè¾“å…¥çš„æ–‡ä»¶æè¿°ç¬¦</li><li>n&gt;&amp;- å…³é—­ä¸€ä¸ªè¾“å‡ºçš„æ–‡ä»¶æè¿°ç¬¦</li></ul><p><strong>read å‘½ä»¤ä¸­ä½¿ç”¨é‡å®šå‘</strong></p><p>å¸¸è§„ä½¿ç”¨ read è¯»å–æ–‡ä»¶ä¸­æ‰€æœ‰çš„å†…å®¹æ—¶ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ä¸€ä¸ªç®€å•çš„é‡å®šå‘ï¼Œç®€å•çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-shell"><code class="language-shell"><span class="token keyword">while</span> <span class="token builtin class-name">read</span> -r line<span class="token punctuation">;</span> <span class="token keyword">do</span>
	<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$line</span>"</span>
<span class="token keyword">done</span> <span class="token operator">&lt;</span> <span class="token function">file</span>
</code></pre><p>ç„¶è€Œæˆ‘ä»¬æ­¤æ—¶æˆ‘ä»¬æƒ³åœ¨å¾ªç¯ä½“å†…å®¹å†ä¸€æ¬¡ä½¿ç”¨ read è¯»å–æ ‡å‡†è¾“å…¥æ—¶ï¼Œå°±ä¼šå‡ºé”™äº†ã€‚è¿™æ—¶ä½¿ç”¨æŒ‡å®šæè¿°ç¬¦çš„æ–¹å¼å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">exec</span> <span class="token number">3</span> <span class="token operator">&lt;</span> <span class="token function">file</span>
<span class="token keyword">while</span> <span class="token builtin class-name">read</span> -u <span class="token number">3</span> line<span class="token punctuation">;</span> <span class="token keyword">do</span>
	<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$line</span>"</span>
	<span class="token builtin class-name">read</span> -p <span class="token string">"continue to read?"</span> -n <span class="token number">1</span>
<span class="token keyword">done</span>
</code></pre><p>è¿™æ ·å°±èƒ½å¤Ÿå¾ˆå¥½åŒºåˆ†å¼€ä¸åŒçš„æè¿°ç¬¦ï¼Œä¸è‡³äºä½¿å¾—åé¢çš„ä½¿ç”¨ä¼šå‡ºé”™ã€‚</p><div class="outer" data-v-a0e12a16=""><div class="short-hr" data-v-a0e12a16=""></div></div><h2 id="here-document-å’Œ-here-strings"><a class="header-anchor" href="#here-document-å’Œ-here-strings" aria-hidden="true">#</a>Here document å’Œ Here strings</h2><p>å®é™…ä¸Šè¿™ä¸¤è€…éƒ½æ˜¯åŸºäºé‡å®šå‘çš„ï¼Œä¸è¿‡åœ¨æŸäº›æ—¶å€™è¿˜æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚æ¯”å¦‚ here document åœ¨è¾“å‡º usage çš„æ—¶å€™å°±æœ‰å¾ˆå¥½çš„ä½¿ç”¨ï¼Œä½†æ˜¯è¿™é‡Œé¢çš„ä½¿ç”¨è¿˜æ˜¯æœ‰ä¸€å®šçš„æŠ€å·§çš„ã€‚</p><p><code class="op" data-v-46b747e9=""><!--[-->Here document<!--]--></code></p><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">command</span> <span class="token operator">&lt;&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span>word
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.
word
</code></pre><p>here document çš„ä½¿ç”¨ä¸­æœ‰ä¸¤ä¸ªæŠ€å·§ï¼Œä»ä¸Šé¢çš„è¯­æ³•æè¿°ä¸Šèƒ½å¤Ÿçœ‹åˆ°é‚£ä¸ªå¯é€‰çš„<code>-</code>ã€‚ä½¿ç”¨<code>&lt;&lt;-</code>ä¼šå°†æ–‡æœ¬ä¸­çš„å‰å¯¼ tab éƒ½åˆ é™¤ï¼Œè¿™å°±æ„å‘³ç€æ–‡æœ¬ä¸æ˜¯åŸæ ·è¾“å‡ºã€‚</p><p>å¦ä¸€ä¸ªæŠ€å·§æ—¶åœ¨ word ä¸Šã€‚ä¸€èˆ¬æˆ‘ä»¬ä¼šå–ä¸€ä¸ªå…³é”®å­—ç”¨æ¥æ ‡è®°è¾“å…¥çš„ç»“æŸï¼Œä½†æ˜¯è¿™ä¸ª word å¦‚æœåŠ ä¸Šäº†å•å¼•å·ï¼Œæ¯”å¦‚<code>'EOF'</code>è¿™ä¸ªä¼šæŠ‘åˆ¶åé¢ä¸­çš„å˜é‡çš„å±•å¼€ã€‚ç®€å•çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class="language-shell"><code class="language-shell">$ <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'</span>
<span class="token operator">&gt;</span> This is my name <span class="token variable">$name</span>
<span class="token operator">&gt;</span> EOF
This is my name <span class="token variable">$name</span>
</code></pre><p>åŒæ—¶ Here document ä¹Ÿæ˜¯å¯ä»¥åœ¨ç®¡é“ä¸­ä½¿ç”¨çš„ï¼Œç®€å•çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class="language-shell"><code class="language-shell">$ <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/a/b/g'</span>
<span class="token operator">&gt;</span> abc
<span class="token operator">&gt;</span> nab
<span class="token operator">&gt;</span> EOF
bbc
nbb
</code></pre><p>è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„éœ€æ±‚æ˜¯åœ¨è„šæœ¬ä¸­å°† cat çš„å†…å®¹è¾“å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é‡å®šå‘ã€‚ä¸‹é¢çš„ç¤ºä¾‹æ˜¯åœ¨è„šæœ¬ä¸­ä½¿ç”¨ï¼š</p><pre class="language-shell"><code class="language-shell"><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> filename</span>
aaaa
bbb
ccc
EOF</span>
</code></pre><p><code class="op" data-v-46b747e9=""><!--[-->Here strings<!--]--></code></p><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä½¿ç”¨ here string ä¸»è¦è§£å†³åœ¨å‡ºäº†ç®¡é“ä¹‹åï¼Œè¿˜èƒ½ç»§ç»­ä½¿ç”¨å˜é‡ã€‚æˆ‘ä»¬çŸ¥é“ç®¡é“ç­‰æ˜¯åœ¨ subshell ä¸­ä½¿ç”¨çš„ã€‚æ‰€ä»¥æœ‰äº›å˜é‡åœ¨å‡ºäº†è¿™ä¸ªä½œç”¨åŸŸä¹‹åå°±ä¸å­˜åœ¨äº†ã€‚</p><pre class="language-shell"><code class="language-shell">$ <span class="token builtin class-name">echo</span> <span class="token string">"Hello World"</span> <span class="token operator">|</span> <span class="token builtin class-name">read</span> first second
$ <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$first</span>"</span> <span class="token string">"<span class="token variable">$second</span>"</span>
<span class="token comment"># nothing</span>
</code></pre><p>æ­¤æ—¶ä½¿ç”¨ here strings åˆ™å°±å¾ˆåˆé€‚äº†ã€‚</p><pre class="language-shell"><code class="language-shell">$ <span class="token builtin class-name">read</span> first second <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">"hello world"</span>
$ <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$first</span>"</span> <span class="token string">"<span class="token variable">$second</span>"</span>
hello world
</code></pre><div class="outer" data-v-a0e12a16=""><div class="short-hr" data-v-a0e12a16=""></div></div><h2 id="æ•°å­¦è®¡ç®—"><a class="header-anchor" href="#æ•°å­¦è®¡ç®—" aria-hidden="true">#</a>æ•°å­¦è®¡ç®—</h2><p>æ•°å­¦è®¡ç®—åœ¨ shell ä¸­æœ‰å‡ ç§ä¹¦å†™æ–¹å¼ï¼Œä½†æ˜¯å¤ªå¤šçš„æ–¹å¼æ€»ä¼šè®©äººä¸çŸ¥æ‰€æªï¼Œæ‰€ä»¥è¿˜æ˜¯åªç²¾é€šä¸€ç§æœ€å¥½ç”¨çš„ã€‚å®é™…ä¸Šç°åœ¨æˆ‘ä»¬ä½¿ç”¨çš„æœ€å¤šçš„æ˜¯<code>(( ))</code>ï¼Œ æœ‰æ—¶æˆ‘ä»¬è¿˜ä¼šä½¿ç”¨<code>$(( ))</code>è¿™ä¸ªæ˜¯ POSIX çš„ä¸€ä¸ªå½¢å¼ã€‚</p><p>bash ä¸­æœ‰ä¸€ä¸ªè¯­æ³•ï¼Œç”¨æ¥è½¬æ¢è¿›åˆ¶çš„ã€‚å³ï¼š<code>&lt;base&gt;#number</code>æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨<code>$(( ))</code>ä¸­ä½¿ç”¨ã€‚å…¶æ¬¡åœ¨æ•°å­¦è®¡ç®—ç¬¦ä¸­å¯ä»¥ä¸ç”¨ä½¿ç”¨<code>$</code>ç¬¦æ¥å¼•ç”¨å˜é‡ã€‚</p><pre class="language-shell"><code class="language-shell">$ <span class="token variable"><span class="token punctuation">((</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> a<span class="token operator">+</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">))</span></span>
$ <span class="token builtin class-name">echo</span> <span class="token variable">$a</span>
<span class="token number">3</span>
$ <span class="token builtin class-name">printf</span> <span class="token string">'%d<span class="token entity" title="\n">\n</span>'</span> <span class="token variable"><span class="token variable">$((</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">3</span><span class="token variable">))</span></span>
<span class="token number">4</span>
</code></pre><p>åœ¨<code>$(( ))</code>ä¸­ä¹Ÿæ˜¯æ”¯æŒå˜é‡æ“ä½œçš„ã€‚æ¯”å¦‚ï¼š</p><pre class="language-bash"><code class="language-bash">$ <span class="token variable"><span class="token punctuation">((</span>a<span class="token operator">=</span><span class="token number">16</span>#abc<span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token number">16</span>#${a<span class="token operator">:</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">2</span>}<span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token builtin class-name">printf</span> <span class="token string">'%s, %s<span class="token entity" title="\n">\n</span>'</span> <span class="token variable">$a</span> <span class="token variable">$b</span>
<span class="token number">2748</span>, <span class="token number">39</span>
</code></pre><p>æ³¨æ„å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯åˆæ³•çš„ï¼Œä¹Ÿæœ‰ä¸€äº›æƒ…å†µéœ€è¦æˆ‘ä»¬æ³¨æ„åˆ°ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼š</p><pre class="language-bash"><code class="language-bash">$ <span class="token assign-left variable">x</span><span class="token operator">=</span><span class="token number">1</span>
$ <span class="token builtin class-name">echo</span> <span class="token variable"><span class="token variable">$((</span>$x[<span class="token number">0</span>]<span class="token variable">))</span></span> <span class="token comment"># å°†ä¼šè¢«æ‰©å±•ä¸º $((1[0]))</span>
bash: <span class="token number">1</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>: syntax error: invalid arithmetic operator <span class="token punctuation">(</span>error token is <span class="token string">"[0]"</span><span class="token punctuation">)</span>
$ <span class="token builtin class-name">printf</span> <span class="token string">'%d<span class="token entity" title="\n">\n</span>'</span> <span class="token variable"><span class="token variable">$((</span>${x[<span class="token number">0</span>]}<span class="token variable">))</span></span>
<span class="token number">1</span>
$ <span class="token builtin class-name">printf</span> <span class="token string">'%d<span class="token entity" title="\n">\n</span>'</span> <span class="token variable"><span class="token variable">$((</span>"$x" <span class="token operator">==</span> <span class="token number">1</span><span class="token variable">))</span></span>  <span class="token comment"># è§£æä¸º $(("1"))</span>
<span class="token number">1</span>
</code></pre><p>æ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å˜é‡æ‰©å±•ä½œä¸ºå¸ƒå°”å€¼çš„åˆ¤æ–­ã€‚æ¯”å¦‚ï¼š</p><pre class="language-bash"><code class="language-bash"><span class="token keyword">if</span> <span class="token variable"><span class="token punctuation">((</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">then</span>
	<span class="token builtin class-name">echo</span> <span class="token string">"true"</span>
<span class="token keyword">else</span>
	<span class="token builtin class-name">echo</span> <span class="token string">"false"</span>
<span class="token keyword">fi</span>
<span class="token comment"># false</span>
</code></pre><div class="outer" data-v-a0e12a16=""><div class="short-hr" data-v-a0e12a16=""></div></div><h2 id="echo-è¾“å‡º"><a class="header-anchor" href="#echo-è¾“å‡º" aria-hidden="true">#</a>echo è¾“å‡º</h2><p>echo åœ¨ä½¿ç”¨<code>-e</code>çš„æ—¶å€™å¯ä»¥æ”¯æŒè½¬ä¹‰å­—ç¬¦çš„è¾“å‡ºï¼Œä½†æ˜¯å¦‚æœä¸æƒ³ä½¿ç”¨è¿™ä¸ªæ ‡è®°çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡<code></code></p><div id="app"><code>#39;string'</code>çš„æ–¹å¼æ¥è¿›è¡Œã€‚æ¯”å¦‚ï¼š<p></p><pre class="language-bash"><code class="language-bash">$ <span class="token builtin class-name">echo</span> <span class="token string">"This is a line"</span>$<span class="token string">'<span class="token entity" title="\n">\n</span>'</span>
This is a line

$
</code></pre><h3 id="e-é—®é¢˜"><a class="header-anchor" href="#e-é—®é¢˜" aria-hidden="true">#</a><code>-e</code>é—®é¢˜</h3><p>åœ¨æ—¥å¸¸ç¼–å†™è„šæœ¬çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹ æƒ¯äºä½¿ç”¨ echo æ¥å®Œæˆå†…å®¹çš„è¾“å‡ºã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ echo æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„ã€‚ä½†æ˜¯æœ‰æ—¶ echo ä¼šå› ä¸ºä¸€äº›å¥‡æ€ªçš„é—®é¢˜å‡ºç°ä¸€äº›ä¸å¯é¢„æœŸçš„ç»“æœã€‚</p><pre class="language-bash"><code class="language-bash">$ <span class="token assign-left variable">a</span><span class="token operator">=</span>-e
$ <span class="token builtin class-name">echo</span> <span class="token variable">$a</span>

$
</code></pre><p>æ­¤æ—¶ä¾¿ä»€ä¹ˆéƒ½ä¸ä¼šè¾“å‡ºï¼Œå³ä½¿æˆ‘ä»¬å¯¹å˜é‡åŠ ä¸Š<code>"$a"</code>ä¹Ÿä¸ä¼šè¾“å‡ºä»»ä½•å†…å®¹ï¼ŒåŒæ ·çš„, å¦‚æœå˜é‡çš„å†…å®¹æ˜¯<code>-n/-E</code>ä¹Ÿä¼šæœ‰åŒæ ·çš„é—®é¢˜ã€‚è¿™äº›å†…å®¹æ˜¯ echo çš„ç›¸å…³é€‰é¡¹ã€‚åŒæ ·çš„é—®é¢˜åœ¨ zipecho å‘½ä»¤ä¼šæœ‰ï¼Œå› ä¸ºè¿™ä¸ªå‘½ä»¤ä¸­ä½¿ç”¨äº† echo å’Œ sed çš„ç»„åˆã€‚</p><p>å› æ­¤æ¯”è¾ƒæ¨èçš„æ˜¯ä½¿ç”¨ printf ä½œä¸ºé¦–é€‰çš„æ‰“å°è¾“å‡ºã€‚å¦‚æœå®åœ¨æƒ³ç”¨ echo ï¼Œä¸Šé¢çš„é—®é¢˜ä¹Ÿæ˜¯æœ‰ä¸€ä¸ªè§„é¿æ–¹å¼çš„ï¼Œå³ï¼š</p><pre class="language-bash"><code class="language-bash">$ <span class="token assign-left variable">a</span><span class="token operator">=</span>-e
$ <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$a</span> "</span>
-e
</code></pre><p>åœ¨å˜é‡åå¢åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œæ­¤æ—¶åˆ™ä¼šè¢«è§£é‡Šä¸ºå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªé€‰é¡¹ã€‚</p><div class="outer" data-v-a0e12a16=""><div class="short-hr" data-v-a0e12a16=""></div></div><h2 id="trap"><a class="header-anchor" href="#trap" aria-hidden="true">#</a>trap</h2><p>trap ä¸€èˆ¬ç”¨äºè„šæœ¬é€€å‡ºæ—¶çš„ä¸€äº›çŠ¶æ€æ¸…ç†å·¥ä½œï¼Œåœ¨æ•æ‰åˆ°ä¸€å®šçš„ä¿¡å·åä½œå‡ºå¯¹åº”çš„ä½œç”¨ã€‚æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ç›‘å¬ EXIT çš„äº‹ä»¶ã€‚ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">trap</span> <span class="token string">'[ <span class="token variable">$?</span> -eq 0 ] || dosomething'</span> EXIT
</code></pre><div class="outer" data-v-a0e12a16=""><div class="short-hr" data-v-a0e12a16=""></div></div><h2 id="split"><a class="header-anchor" href="#split" aria-hidden="true">#</a>split</h2><p>split åœ¨ shell ä¸­å¹¶ä¸æ˜¯åŸç”Ÿæ”¯æŒï¼Œéœ€è¦è‡ªå·±å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œä¸€èˆ¬ä½¿ç”¨ read æ¥å®ç°ã€‚</p><pre class="language-bash"><code class="language-bash"><span class="token function-name function">split</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment"># Usage: split "string" "delimiter"</span>
   <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span>$<span class="token string">'<span class="token entity" title="\n">\n</span>'</span> <span class="token builtin class-name">read</span> -d <span class="token string">""</span> -ra arr <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">"<span class="token variable">${1<span class="token operator">/</span><span class="token operator">/</span>$2<span class="token operator">/</span></span></span></code><div id="app"><code class="language-bash">#39;\n'}"
   <span class="token builtin class-name">printf</span> <span class="token string">'%s<span class="token entity" title="\n">\n</span>'</span> <span class="token string">"<span class="token variable">${arr<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span>
<span class="token punctuation">}</span>
</code></div></pre><p>è¿™ç§æ–¹å¼åœ¨æ­£å¸¸åœºæ™¯ä¸‹å¹¶ä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯å½“æˆ‘ä»¬è®¾ç½®äº†<code>set -e</code>åï¼Œä¸Šè¿°å®ç°å°±ä¼šæå‰é€€å‡ºã€‚ç®€å•è§£é‡Šä¸€ä¸‹ï¼š</p><pre class="language-bash"><code class="language-bash">$ <span class="token builtin class-name">read</span> -d <span class="token string">''</span> <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">'Hello World'</span>
$ <span class="token builtin class-name">echo</span> <span class="token variable">$?</span>
<span class="token number">1</span>
</code></pre><p>è¿™ä¸ªæ–¹å¼åœ¨ while å¾ªç¯ä¸­æ˜¯éå¸¸å‹å¥½çš„æ–¹å¼ï¼Œä½†æ˜¯ç”±äºè®¾ç½®<code>set -e</code>, å­˜åœ¨è¿”å›å€¼ä¸ä¸º0 çš„æ—¶å€™ï¼Œç¨‹åºä¼šè‡ªåŠ¨é€€å‡ºã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ read ä¹‹åå°±ç›´æ¥ exit äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç®€å•çš„è§„é¿ä¸€ä¸‹:</p><pre class="language-bash"><code class="language-bash"><span class="token function-name function">split</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment"># Usage: split "string" "delimiter"</span>
   <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span>$<span class="token string">'<span class="token entity" title="\n">\n</span>'</span> <span class="token builtin class-name">read</span> -d <span class="token string">""</span> -ra arr <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">"<span class="token variable">${1<span class="token operator">/</span><span class="token operator">/</span>$2<span class="token operator">/</span></span></span></code><div id="app"><code class="language-bash">#39;\n'}" <span class="token operator">||</span> <span class="token boolean">true</span>
   <span class="token builtin class-name">printf</span> <span class="token string">'%s<span class="token entity" title="\n">\n</span>'</span> <span class="token string">"<span class="token variable">${arr<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span>
<span class="token punctuation">}</span>
</code></div></pre><p>é€šè¿‡<code>||</code>å°†è¿”å›å€¼é‡æ–°å˜æˆ 0 ä¸”é€»è¾‘ä¸Šä¹Ÿæ˜¯ç¬¦åˆéœ€æ±‚çš„ã€‚</p><div class="outer" data-v-a0e12a16=""><div class="short-hr" data-v-a0e12a16=""></div></div><h2 id="tee-redirection"><a class="header-anchor" href="#tee-redirection" aria-hidden="true">#</a>tee redirection</h2><p>åœ¨ shell ä¸­å®ç° tee å¯¹ stdout å’Œ stderr çš„é‡å®šå‘ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„æ–¹å¼ï¼š</p><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">command</span> <span class="token operator">&gt;</span> <span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token function">tee</span> -a stdout.log<span class="token punctuation">)</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> <span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token function">tee</span> -a stderr.log <span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;2</span><span class="token punctuation">)</span>
</code></pre><p>å…¶ä¸­,<code>&gt;(...) (process substitution)</code>åˆ›å»ºä¸€ä¸ª FIFOï¼ŒåŒæ—¶å°† command çš„è¾“å‡ºé‡å®šå‘åˆ°è¿™ä¸ª FIFO ä¸­ã€‚</p><div class="outer" data-v-a0e12a16=""><div class="short-hr" data-v-a0e12a16=""></div></div><h2 id="find"><a class="header-anchor" href="#find" aria-hidden="true">#</a>find</h2><p>æˆ‘ä»¬é€šå¸¸éœ€è¦å°† find çš„ç»“æœæ”¾åˆ°ä¸€ä¸ª array ä¸­ã€‚å¦‚æœ bash ç‰ˆæœ¬çš„æ¯”è¾ƒä½çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨é€šè¿‡å¦‚ä¸‹çš„æ–¹å¼è¿›è¡Œï¼š</p><pre class="language-bash"><code class="language-bash"><span class="token assign-left variable">array</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span>  <span class="token builtin class-name">read</span> -r -d $<span class="token string">'<span class="token entity" title="\0">\0</span>'</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token assign-left variable">array</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token string">"<span class="token environment constant">$REPLY</span>"</span><span class="token punctuation">)</span>
<span class="token keyword">done</span> <span class="token operator">&lt;</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token function">find</span> * -type d  -print0<span class="token punctuation">)</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">item</span> <span class="token keyword">in</span> <span class="token string">"<span class="token variable">${array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$item</span>"</span>
<span class="token keyword">done</span>

<span class="token comment"># output</span>
<span class="token comment"># dirl </span>
<span class="token comment"># dir2</span>
</code></pre><p>ä¸Šé¢æ˜¯æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰çš„ç›®å½•ç±»å‹ã€‚ æ³¨æ„è¿™è¾¹ find ç”¨çš„æ˜¯<code>*</code>ã€‚è¿™ä¼šå»æ‰ç»“æœå‰é¢çš„<code>./</code>è¿™ä¸ªå‰ç¼€ã€‚å¦‚æœæˆ‘ä»¬çš„ bash ç‰ˆæœ¬åœ¨ 4.4 ä»¥ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä¸€è¡Œå‘½ä»¤å®Œæˆã€‚</p><pre class="language-bash"><code class="language-bash">$ <span class="token builtin class-name">mapfile</span> -d $<span class="token string">'<span class="token entity" title="\0">\0</span>'</span> array <span class="token operator">&lt;</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token function">find</span> * -type d -print0<span class="token punctuation">)</span>
<span class="token comment"># or </span>
$ <span class="token builtin class-name">readarray</span> -d <span class="token string">''</span> array2 <span class="token operator">&lt;</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token function">find</span> * -type d -print0<span class="token punctuation">)</span>
</code></pre><p></p><div class="list-item" data-v-6caa15cd=""><span data-v-6caa15cd="">[<span data-v-6caa15cd=""><img style="display:inline-block;margin-right:2px;margin-top:1px;margin-bottom:2px" src="https://api.iconify.design/mdi:link-variant.svg" data-v-6caa15cd=""></span><a class="item-show" href="https://linuxcommand.org/lc3_man_pages/mapfileh.html" target="_blank" data-v-6caa15cd="">mapfile doc</a>]:<!--[--> man mapfile<!--]--></span></div><div class="list-item" data-v-6caa15cd=""><span data-v-6caa15cd="">[<span data-v-6caa15cd=""><img style="display:inline-block;margin-right:2px;margin-top:1px;margin-bottom:2px" src="https://api.iconify.design/mdi:link-variant.svg" data-v-6caa15cd=""></span><a class="item-show" href="https://helpmanual.io/builtin/readarray/" target="_blank" data-v-6caa15cd="">readarray doc</a>]:<!--[--> man readarray<!--]--></span></div><p></p><div class="outer" data-v-a0e12a16=""><div class="short-hr" data-v-a0e12a16=""></div></div><h2 id="set"><a class="header-anchor" href="#set" aria-hidden="true">#</a>set</h2><p><code class="op" data-v-46b747e9=""><!--[-->-x<!--]--></code></p><p>åœ¨æ—¥å¸¸è„šæœ¬ä¸­æˆ‘ä»¬éœ€è¦è°ƒè¯•æ—¶ï¼Œå¯ä»¥åœ¨è„šæœ¬çš„å¼€å¤´æˆ–è€…æ˜¯éœ€è¦è°ƒè¯•çš„å‡½æ•°é™„è¿‘åŠ ä¸Š<code>set -x</code>ã€‚è¿™æ ·åœ¨æ­¤ä¹‹åçš„è„šæœ¬éƒ½ä¼šä»¥è°ƒè¯•æ¨¡å¼è¾“å‡ºï¼Œåœ¨ä¸æƒ³è°ƒè¯•çš„ä»£ç å‰åŠ ä¸Š<code>set +x</code>ä»¥å…³é—­è°ƒè¯•åŠŸèƒ½ã€‚</p><p>åœ¨ç°ä»£çš„ bash è„šæœ¬ï¼Œæ”¯æŒåœ¨è„šæœ¬å†…å¯ä»¥ç›´æ¥å°†è°ƒè¯•çš„è¾“å‡ºé‡å®šå‘åˆ°æŒ‡å®šçš„æ–‡ä»¶å†…ï¼Œæ–¹å¼å¦‚ä¸‹ï¼š</p><pre class="language-bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token builtin class-name">exec</span> <span class="token number">1</span><span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>logfile
<span class="token assign-left variable">BASH_XTRACEFD</span><span class="token operator">=</span><span class="token number">19</span>

<span class="token builtin class-name">set</span> -x
command1
command2
<span class="token punctuation">..</span>.
</code></pre><p>å…¶ä¸­<code>BASH_XTRACEFD</code>æ˜¯ç”¨æ¥æŒ‡å®šæ–‡ä»¶æè¿°ç¬¦ç»™<code>set -x</code>çš„ã€‚</p><p></p><div class="list-item" data-v-6caa15cd=""><span data-v-6caa15cd="">[<span data-v-6caa15cd=""><img style="display:inline-block;margin-right:2px;margin-top:1px;margin-bottom:2px" src="https://api.iconify.design/mdi:link-variant.svg" data-v-6caa15cd=""></span><a class="item-show" href="https://askubuntu.com/questions/811439/bash-set-x-logs-to-file" target="_blank" data-v-6caa15cd="">refernece1</a>]:<!--[--> bash set -x log to file<!--]--></span></div><div class="list-item" data-v-6caa15cd=""><span data-v-6caa15cd="">[<span data-v-6caa15cd=""><img style="display:inline-block;margin-right:2px;margin-top:1px;margin-bottom:2px" src="https://api.iconify.design/mdi:stack-overflow.svg" data-v-6caa15cd=""></span><a class="item-show" href="https://stackoverflow.com/questions/11229385/redirect-all-output-in-a-bash-script-when-using-set-x" target="_blank" data-v-6caa15cd="">reference2</a>]:<!--[--> redirect all output in a bash script when using set -x<!--]--></span></div><p></p><p><code class="op" data-v-46b747e9=""><!--[-->-e<!--]--></code></p><p>Abort script at first error, when a command exits with non-zero status (except in until or while loops, if-tests, list constructs)</p><blockquote><p>-e Exit immediately if a pipeline (which may consist of a single simple command), a list, or a compound command (see SHELL GRAMMAR above), exits with a non-zero status.<br>The shell does not exit if the command that fails is part of the command list immediately following a while or until keyword, part of the test following the if or elif reserved words, part of any command executed in a &amp;&amp; or || list except the command following the final &amp;&amp; or ||, any command in a pipeline but the last, or if the commandâ€™s return value is being inverted with !.<br>If a compound command other than a subshell returns a non-zero status because a command failed while -e was being ignored, the shell does not exit.<br>A trap on ERR, if set, is executed before the shell exits. This option applies to the shell environment and each subshell environment separately (see COMMAND EXECUTION ENVIRONMENT above), and may cause subshells to exit before executing all the commands in the subshell. If a compound command or shell function executes in a context where -e is being ignored, none of the commands executed within the compound command or function body will be affected by the -e setting, even if -e is set and a command returns a failure status. If a compound command or shell function sets -e while executing in a context where -e is ignored, that setting will not have any effect until the compound command or the command containing the function call completes.</p></blockquote><p>å…¶ä¸­éœ€è¦æ³¨æ„çš„æ˜¯:<strong>The shell does not exit if the command that fails is part of the command list immediately following a while or until keyword, part of the test following the if or elif reserved words, part of any command executed in a &amp;&amp; or || list except the command following the final &amp;&amp; or ||, any command in a pipeline but the last, or if the commandâ€™s return value is being inverted with !.</strong>è¿™ç§æƒ…å†µä¸‹ä¼šå¤±æ•ˆã€‚</p><p>æ¯”å¦‚ï¼š</p><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">set</span> -e
<span class="token boolean">false</span> <span class="token operator">&amp;&amp;</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token string">"will print"</span>
<span class="token boolean">true</span> <span class="token operator">&amp;&amp;</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token string">"not print"</span>
<span class="token boolean">true</span> <span class="token operator">&amp;&amp;</span> <span class="token boolean">false</span> <span class="token operator">||</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token string">"will print"</span>
</code></pre><p>è¿™æ˜¯å› ä¸ºä½¿ç”¨äº†<code>&amp;&amp;</code>ä¹‹åï¼Œshell ä¼šè®¤ä¸º<code>&amp;&amp;</code>å·¦ä¾§éƒ¨åˆ†æ˜¯è¢« test è¿‡äº†ï¼Œå†åŠ ä¸ŠçŸ­è·¯åŸåˆ™ï¼Œå³ä¾§éƒ¨åˆ†ä¸ä¼šæ‰§è¡Œåˆ°ï¼Œæ‰€ä»¥<code>set -e</code>ä¾¿æ²¡æœ‰è¢«è§¦å‘ã€‚ å®é™…ä¸Š<code>&amp;&amp;</code>æ˜¯ä¸€ä¸ª<strong>list constructs</strong>ã€‚è¿™ç§æƒ…å†µä¸‹å°±ä¸ä¼šè§¦å‘<code>set -e</code>äº†ã€‚</p><p></p><div class="list-item" data-v-6caa15cd=""><span data-v-6caa15cd="">[<span data-v-6caa15cd=""><img style="display:inline-block;margin-right:2px;margin-top:1px;margin-bottom:2px" src="https://api.iconify.design/mdi:link-variant.svg" data-v-6caa15cd=""></span><a class="item-show" href="https://tldp.org/LDP/abs/html/options.html" target="_blank" data-v-6caa15cd="">TLDP Reference</a>]:<!--[--> Set Releated Info<!--]--></span></div><div class="list-item" data-v-6caa15cd=""><span data-v-6caa15cd="">[<span data-v-6caa15cd=""><img style="display:inline-block;margin-right:2px;margin-top:1px;margin-bottom:2px" src="https://api.iconify.design/mdi:stack-overflow.svg" data-v-6caa15cd=""></span><a class="item-show" href="https://stackoverflow.com/a/47625345/4168837" target="_blank" data-v-6caa15cd="">StackOverflow</a>]:<!--[--> Why does set -e; true &amp;&amp; false &amp;&amp; true not exit?<!--]--></span></div><p></p><div class="outer" data-v-a0e12a16=""><div class="short-hr" data-v-a0e12a16=""></div></div><h2 id="check-file"><a class="header-anchor" href="#check-file" aria-hidden="true">#</a>check file</h2><p>Linux ç³»ç»Ÿä¸Šï¼Œä¸€åˆ‡çš†æ–‡ä»¶ï¼Œä½†æ˜¯æ–‡ä»¶ä¹Ÿæœ‰ä¸åŒçš„ç±»å‹ï¼Œå½“æˆ‘ä»¬éœ€è¦åœ¨è„šæœ¬ä¸­åˆ¤æ–­æŸä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨æ—¶ï¼Œå¯ä»¥é€šè¿‡å†…ç½®çš„ flag æ¥åˆ¤æ–­ï¼š</p><ul><li>-f file(<strong>not directory or device file</strong>)</li><li>-d directory</li><li>-c character device</li><li>-b block device</li><li>-p named pipe</li><li>-S socket</li><li>-e file exists</li><li>-r readable</li><li>-w writable</li><li>-x executable</li><li>-s file is not zero size</li><li>-O you are owner of file</li><li>-G group-id of file same as yours</li><li>-N file modified since it was last read</li></ul><pre class="language-bash"><code class="language-bash"><span class="token keyword">if</span> <span class="token punctuation">[</span> -f /etc/passwd <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"File exists"</span>
<span class="token keyword">fi</span>
</code></pre><p></p><div class="list-item" data-v-6caa15cd=""><span data-v-6caa15cd="">[<span data-v-6caa15cd=""><img style="display:inline-block;margin-right:2px;margin-top:1px;margin-bottom:2px" src="https://api.iconify.design/mdi:link-variant.svg" data-v-6caa15cd=""></span><a class="item-show" href="https://tldp.org/LDP/abs/html/fto.html" target="_blank" data-v-6caa15cd="">tldp</a>]:<!--[--> File test operators<!--]--></span></div><p></p><div class="outer" data-v-a0e12a16=""><div class="short-hr" data-v-a0e12a16=""></div></div><h2 id="parameters-substitution"><a class="header-anchor" href="#parameters-substitution" aria-hidden="true">#</a>Parameters Substitution</h2><pre class="language-bash"><code class="language-bash">+ <span class="token variable">${var}</span>            Value of var <span class="token punctuation">(</span>same as <span class="token variable">$var</span><span class="token punctuation">)</span>	 
+ <span class="token variable">${var-$DEFAULT}</span>   If var not set, evaluate expression as <span class="token variable">$DEFAULT</span> *
+ <span class="token variable">${var<span class="token operator">:-</span>$DEFAULT}</span>	If var not <span class="token builtin class-name">set</span> or is empty, evaluate expression as <span class="token variable">$DEFAULT</span> *
+ <span class="token variable">${var=$DEFAULT}</span>   If var not set, evaluate expression as <span class="token variable">$DEFAULT</span> *
+ <span class="token variable">${var<span class="token operator">:=</span>$DEFAULT}</span>	If var not <span class="token builtin class-name">set</span> or is empty, evaluate expression as <span class="token variable">$DEFAULT</span> *
+ <span class="token variable">${var+$OTHER}</span>	    If var set, evaluate expression as <span class="token variable">$OTHER</span>, otherwise as null string
+ <span class="token variable">${var<span class="token operator">:+</span>$OTHER}</span>    If var set, evaluate expression as <span class="token variable">$OTHER</span>, otherwise as null string
+ <span class="token variable">${var?$ERR_MSG}</span>   If var not set, print <span class="token variable">$ERR_MSG</span> and abort script with an <span class="token builtin class-name">exit</span> status of <span class="token number">1</span>.*
+ <span class="token variable">${var<span class="token operator">:?</span>$ERR_MSG}</span>  If var not set, print <span class="token variable">$ERR_MSG</span> and abort script with an <span class="token builtin class-name">exit</span> status of <span class="token number">1</span>.*
+ <span class="token variable">${<span class="token operator">!</span>varprefix*}</span>    Matches all previously declared variables beginning with varprefix
+ <span class="token variable">${<span class="token operator">!</span>varprefix@}</span>    Matches all previously declared variables beginning with varprefix
</code></pre><p></p><div class="list-item" data-v-6caa15cd=""><span data-v-6caa15cd="">[<span data-v-6caa15cd=""><img style="display:inline-block;margin-right:2px;margin-top:1px;margin-bottom:2px" src="https://api.iconify.design/mdi:link-variant.svg" data-v-6caa15cd=""></span><a class="item-show" href="https://tldp.org/LDP/abs/html/refcards.html#AEN22728" target="_blank" data-v-6caa15cd="">tldp</a>]:<!--[--> Reference Cards<!--]--></span></div><p></p><h2 id="array-as-parameter"><a class="header-anchor" href="#array-as-parameter" aria-hidden="true">#</a>array as parameter</h2><p>åœ¨ bash ä¸­å°†æ•°ç»„ä½œä¸ºå‡½æ•°å‚æ•°ä¼ é€’æ—¶ï¼Œæ–¹å¼ä¸å…¶ä»–çš„è¯­è¨€ç•¥æœ‰ä¸åŒã€‚å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p><pre class="language-bash"><code class="language-bash"><span class="token function-name function">copyfiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token assign-left variable">dst</span><span class="token operator">=</span><span class="token variable">$1</span>
	<span class="token builtin class-name">shift</span>
	<span class="token assign-left variable">srcs</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">$@</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> <span class="token for-or-select variable">src</span> <span class="token keyword">in</span> <span class="token string">"<span class="token variable">$srcs</span>{@}"</span><span class="token punctuation">;</span><span class="token keyword">do</span>
	   <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.
	<span class="token keyword">done</span>
<span class="token punctuation">}</span>

copyfiles <span class="token string">"<span class="token variable">$dst</span>"</span> <span class="token string">"<span class="token variable">${srcs<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span>
</code></pre><h2 id="readarray"><a class="header-anchor" href="#readarray" aria-hidden="true">#</a>readarray</h2><p>åœ¨ bash 4+ ç‰ˆæœ¬é‡Œé¢å¼•å…¥äº† readarray å†…å»ºå‘½ä»¤ï¼Œç”¨äºè¯»å–æŒ‡å®šçš„å†…å®¹åˆ°æ•°ç»„å†…ã€‚</p><h2 id="debug-shell-script"><a class="header-anchor" href="#debug-shell-script" aria-hidden="true">#</a>debug shell script</h2><pre class="language-bash"><code class="language-bash">$ <span class="token punctuation">(</span>exec <span class="token number">11</span><span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> log <span class="token punctuation">;</span>
<span class="token builtin class-name">export</span> <span class="token environment constant">SHELLOPTS</span> <span class="token assign-left variable">BASH_XTRACEFD</span><span class="token operator">=</span><span class="token number">111</span> <span class="token assign-left variable"><span class="token environment constant">PS4</span></span><span class="token operator">=</span><span class="token string">'(<span class="token environment constant">$BASH_SOURCE</span>:<span class="token variable">$LINENO</span>:<span class="token variable">$FUNCNAME</span>): '</span> <span class="token punctuation">;</span>
<span class="token builtin class-name">set</span> -x <span class="token punctuation">;</span> ./cih.sh<span class="token punctuation">)</span>
</code></pre></div><!--]--></div></div></article></div></div></main><footer max-w="screen-lg" m="ml-4" w="full" p="y-8" text="dark:white dark:opacity-50 sm"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0 2025 Â© Jesse Chan</a></footer></div></div><script>!function(){var e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,a=localStorage.getItem("color-schema")||"auto";("dark"===a||e&&"light"!==a)&&document.documentElement.classList.toggle("dark",!0)}()</script></body></html>