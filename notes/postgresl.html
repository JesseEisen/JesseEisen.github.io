<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="referrer" content="no-referrer"><link rel="icon" href="/favicon.svg" type="image/svg+xml"><link rel="apple-touch-icon" href="/pwa-192x192.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#00aba9"><meta name="msapplication-TileColor" content="#00aba9"><meta name="theme-color" content="#ffffff"><script type="module" async="" crossorigin="" src="/assets/app.9a86a0a7.js"></script><link rel="modulepreload" href="/assets/vendor.57ddf3fb.js"><link rel="stylesheet" href="/assets/app.bb10de41.css"><link rel="manifest" href="/manifest.webmanifest"><link rel="modulepreload" crossorigin="" href="/assets/postgresl.56869594.js"><link rel="modulepreload" crossorigin="" href="/assets/Comment.173f8bf9.js"><link rel="stylesheet" href="/assets/Comment.ef8b45f2.css"><meta property="og:title" content="PostgreSQL In Action"><meta property="og:description" content="postgresql"><meta name="description" content="postgresql"><meta name="head:count" content="3"><title>Chan93</title></head><body><div id="app" data-server-rendered="true"><div h="full" flex="~ col" p="x-4"><nav z="100" text="dark-100 dark:light-900" position="fixed top-0 left-0 right-0" bg="dark:dark-500 dark:opacity-50 white opacity-75" backdrop="~ blur-lg" h="18" p="x-4" border="b-1 dark:dark-500"><div max-w="screen-lg" m="x-auto" h="full" flex="~ row" items="center" space="x-4"><a href="/" class="" flex="1"><h1 text="2xl" font="bold">ğŸ£ WhatIf</h1></a><a href="/blogs" class=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 256"><path d="M88 96a8 8 0 0 1 8-8h64a8 8 0 0 1 0 16H96a8 8 0 0 1-8-8zm8 40h64a8 8 0 0 0 0-16H96a8 8 0 0 0 0 16zm32 16H96a8 8 0 0 0 0 16h32a8 8 0 0 0 0-16zm96-104v108.687A15.894 15.894 0 0 1 219.313 168L168 219.313A15.894 15.894 0 0 1 156.687 224H48a16.018 16.018 0 0 1-16-16V48a16.018 16.018 0 0 1 16-16h160a16.018 16.018 0 0 1 16 16zM48 208h104v-48.008a8 8 0 0 1 8-8h48V48H48zm120-40.008v28.695l28.694-28.695z" fill="currentColor"></path></svg></a><a href="/notes" class=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M13 21v2.5l-3-2l-3 2V21h-.5A3.5 3.5 0 0 1 3 17.5V5a3 3 0 0 1 3-3h14a1 1 0 0 1 1 1v17a1 1 0 0 1-1 1h-7zm0-2h6v-3H6.5a1.5 1.5 0 0 0 0 3H7v-2h6v2zm6-5V4H6v10.035A3.53 3.53 0 0 1 6.5 14H19zM7 5h2v2H7V5zm0 3h2v2H7V8zm0 3h2v2H7v-2z" fill="currentColor"></path></svg></a><a href="/books" class=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M9 3v15h3V3H9m3 2l4 13l3-1l-4-13l-3 1M5 5v13h3V5H5M3 19v2h18v-2H3z" fill="currentColor"></path></svg></a><a href="https://github.com/jesseeisen" target="_blank" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33c.85 0 1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2z" fill="currentColor"></path></svg></a><a cursor="pointer"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg></a></div></nav><main flex="~ 1 row" justify="center" w="full" max-w="screen-lg" m="x-auto" p="t-18" text="dark:light-300 dark-100"><div data-v-2af502ac=""><div data-v-2af502ac=""><a flex="~ row" items="center" class="dark:text-white-900 dark:opacity-60" space="x-2" m="t-4" cursor="pointer" data-v-2af502ac=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32" text="12px" data-v-2af502ac=""><path d="M14 26l1.41-1.41L7.83 17H28v-2H7.83l7.58-7.59L14 6L4 16l10 10z" fill="currentColor"></path></svg><span text="12px dark:light-50 true-gray-500" font="bold" data-v-2af502ac="">Back to prev</span></a></div><header text="center" border="b-1 dark:dark-200" p="y-10" data-v-2af502ac=""><h1 text="36px dark:light-50 dark " font=" extrabold -.015em 48px" class="post-title" data-v-2af502ac="">PostgreSQL In Action</h1><div my="20px" data-v-2af502ac=""><span text="sm dark:light-900 dark:opacity-60 #666" m="b-2" display="block" data-v-2af502ac="">Jan 25, 2021</span></div><div text="left" flex="~" m="t-4" data-v-2af502ac=""><div flex="~ row" items="center" space="x-2" class="mx-auto" data-v-2af502ac="" data-v-22abfd34=""><img border="rounded-full" src="https://secure.gravatar.com/avatar/190aa3adff4e1451b32c354f0b5fd7f9?size=30" data-v-22abfd34=""><div flex="~ col" class="author-info" data-v-22abfd34=""><span text="500 dark:light-900 dark:opacity-80 dark-900" data-v-22abfd34="">Linkang Chan</span><br data-v-22abfd34=""><a href="https://twitter.com/JessEisen_LJ" class="text-pink-500 text-sm" target="_blank" data-v-22abfd34="">@Jesse Chan</a></div></div></div></header><div flex="~" w="100%" justify="center" data-v-2af502ac=""><article m="t-8" data-v-2af502ac=""><div w="90%" class="prose prose-lg" text="dark:light-900 dark:opacity-72" data-v-2af502ac=""><!--[--><div><p>postgresql æ˜¯ä¸€æ¬¾å¼€æºçš„å¯¹è±¡å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€‚pg å¯ä»¥è¯´æ˜¯ä¸€æ¬¾å…¨æ ˆçš„æ•°æ®åº“ï¼Œæ¯•ç«Ÿ slogan æ˜¯ â€œä¸–ç•Œä¸Šæœ€å…ˆè¿›çš„å…³ç³»å‹æ•°æ®åº“â€ã€‚åŒæ—¶ pg æ¯” mysql å°‘ä¸å°‘çš„å‘ï¼Œä½¿ç”¨ä¸Šä¼šèˆ’å¿ƒä¸€äº›ã€‚ æœ¬æ–‡ä¸»è¦æ˜¯è®°å½• pg çš„ä½¿ç”¨æ–¹å¼ï¼ŒåŒæ—¶ä¹Ÿä¼šè®°å½•ä¸€äº› sql çš„è¯­å¥æˆ–è€… pg ç‹¬æœ‰çš„ä¸€äº›æ“ä½œã€‚</p><h3 id="â…°-åˆ›å»ºç”¨æˆ·"><a class="header-anchor" href="#â…°-åˆ›å»ºç”¨æˆ·" aria-hidden="true">#</a>â…  åˆ›å»ºç”¨æˆ·</h3><p>pg å®‰è£…åé»˜è®¤ä¼šæœ‰ä¸€ä¸ª<code>postgres</code>çš„ç”¨æˆ·ï¼Œè¦åˆ›å»ºæ–°ç”¨æˆ·ï¼Œéœ€è¦å…ˆåˆ‡æ¢åˆ°è¯¥è´¦æˆ·ï¼Œç„¶åæ‰§è¡Œå¦‚ä¸‹çš„æ“ä½œã€‚</p><pre class="language-sql"><code class="language-sql">$ su <span class="token operator">-</span> postgres
<span class="token operator">-</span>bash<span class="token operator">-</span><span class="token number">4.2</span>$ psql
postgre<span class="token operator">=</span><span class="token comment"># create user username with password 'xxxxx';</span>
postgre<span class="token operator">=</span><span class="token comment"># create database databaseName owner username;</span>
postgre<span class="token operator">=</span><span class="token comment"># grant all privileges on database databaseName to username;</span>
</code></pre><h3 id="â…±-ç™»å½•æ•°æ®åº“"><a class="header-anchor" href="#â…±-ç™»å½•æ•°æ®åº“" aria-hidden="true">#</a>â…¡ ç™»å½•æ•°æ®åº“</h3><p>ä½¿ç”¨ç”¨æˆ·åå¯†ç ç™»å½•ï¼š</p><pre class="language-sql"><code class="language-sql">$ psql <span class="token operator">-</span>h hosturl <span class="token operator">-</span>U username <span class="token operator">-</span>d databasename <span class="token operator">-</span>p port
</code></pre><p><strong>æ³¨æ„</strong>åœ¨ä¸€äº›ç¼–ç¨‹çš„åº“ä¸­ä½¿ç”¨ä¸Šé¢çš„æ–¹å¼å¯èƒ½ä¼šæŠ¥<code>sslmode required not support</code>ã€‚é€šè¿‡å¢åŠ <code>sslmode=disable</code>å¯ä»¥è§£å†³ã€‚</p><h3 id="â…²-å¯¼å…¥å¯¼å‡º"><a class="header-anchor" href="#â…²-å¯¼å…¥å¯¼å‡º" aria-hidden="true">#</a>â…¢ å¯¼å…¥å¯¼å‡º</h3><p>å¯ä»¥é€šè¿‡ä¸€äº›å¤–éƒ¨å‘½ä»¤å°† pg æ•°æ®åº“ä¸­çš„å†…å®¹å¯¼å‡ºåˆ°ä¸€ä¸ª sql æ–‡ä»¶ä¸­ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å°†è¿™ä¸ª sql æ–‡ä»¶é‡æ–°åº”ç”¨åˆ°å¦å¤–çš„æ•°æ®åº“ä¸­ã€‚æ“ä½œå¦‚ä¸‹ï¼š</p><pre class="language-sql"><code class="language-sql"><span class="token comment"># export to dump.sql</span>
$ pg_dump <span class="token operator">-</span>h hosturl <span class="token operator">-</span>U username databasename <span class="token operator">&gt;</span> <span class="token operator">/</span>path<span class="token operator">/</span>tp<span class="token operator">/</span><span class="token keyword">save</span><span class="token operator">/</span><span class="token keyword">dump</span><span class="token punctuation">.</span><span class="token keyword">sql</span>

<span class="token comment"># import to new database </span>
$ psql <span class="token operator">-</span>h hosturl <span class="token operator">-</span>d <span class="token keyword">database</span> <span class="token operator">-</span>U username <span class="token operator">-</span>f <span class="token keyword">dump</span><span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre><p>æ­¤å¤–å¯¼å‡ºå•ç‹¬ä¸€ä¸ªè¡¨çš„æ“ä½œå¦‚ä¸‹ï¼š</p><pre class="language-sql"><code class="language-sql">pg_dump <span class="token operator">-</span>h localhost <span class="token operator">-</span>p <span class="token number">5432</span> <span class="token operator">-</span>U username <span class="token comment">--format plain --verbose \</span>
   <span class="token comment">--file dump.sql --table public.tablename dbname</span>
</code></pre><p></p><p class="outer" data-v-7c811930="">comment:<!--[--> ä¸è¿‡ä»é«˜ç‰ˆæœ¬å¯¼å‡ºåï¼Œå†å¯¼å…¥åˆ°ä½ç‰ˆæœ¬æ—¶ä¼šæœ‰ä¸€äº›å°é”™è¯¯ã€‚<strong>ä¸€èˆ¬å¯ä»¥é€šè¿‡<code>sed</code>å°†å¯¹åº”çš„è¡Œæ³¨é‡Šæ‰ã€‚</strong><!--]--></p><p></p><h3 id="â…³-æ’å…¥æ•°æ®"><a class="header-anchor" href="#â…³-æ’å…¥æ•°æ®" aria-hidden="true">#</a>â…£ æ’å…¥æ•°æ®</h3><p>values å¯ä»¥æŒ‡å®šå¤šä¸ªï¼Œæ‰¹é‡æ’å…¥ã€‚</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> table_name <span class="token punctuation">(</span>column1<span class="token punctuation">,</span> column2<span class="token punctuation">,</span> column3<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>value1<span class="token punctuation">,</span> value2<span class="token punctuation">,</span> value3<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><h3 id="â…´-æ›´æ–°æ•°æ®"><a class="header-anchor" href="#â…´-æ›´æ–°æ•°æ®" aria-hidden="true">#</a>â…¤ æ›´æ–°æ•°æ®</h3><pre class="language-sql"><code class="language-sql"><span class="token keyword">UPDATE</span> table_name
<span class="token keyword">SET</span> column1 <span class="token operator">=</span> value1<span class="token punctuation">,</span> column2 <span class="token operator">=</span> value2<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> columnN <span class="token operator">=</span> valueN
<span class="token keyword">WHERE</span> <span class="token punctuation">[</span>condition<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">RETURNING</span> <span class="token operator">*</span> <span class="token operator">|</span> output_expression <span class="token keyword">AS</span> output_name<span class="token punctuation">;</span>
</code></pre><p><code>RETURNING</code>è¡¨ç¤ºè¿”å›æ›´æ–°åç¬¦åˆæ¡ä»¶çš„è®°å½•</p><h3 id="â…µ-ä¿®æ”¹è¡¨æ ¼å­—æ®µ"><a class="header-anchor" href="#â…µ-ä¿®æ”¹è¡¨æ ¼å­—æ®µ" aria-hidden="true">#</a>â…¥ ä¿®æ”¹è¡¨æ ¼å­—æ®µ</h3><pre class="language-sql"><code class="language-sql"><span class="token comment"># å¢åŠ å­—æ®µ</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name 
<span class="token keyword">ADD</span> <span class="token keyword">COLUMN</span> column_name datatype column_constraint<span class="token punctuation">;</span>

<span class="token comment"># åˆ é™¤å­—æ®µ</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name 
<span class="token keyword">DROP</span> <span class="token keyword">COLUMN</span> column_name<span class="token punctuation">;</span>

<span class="token comment"># é‡å‘½åå­—æ®µ</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name 
<span class="token keyword">RENAME</span> <span class="token keyword">COLUMN</span> column_name 
<span class="token keyword">TO</span> new_column_name<span class="token punctuation">;</span>

<span class="token comment"># æ”¹å˜é»˜è®¤å€¼</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name 
<span class="token keyword">ALTER</span> <span class="token keyword">COLUMN</span> column_name 
<span class="token punctuation">[</span><span class="token keyword">SET</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">value</span> <span class="token operator">|</span> <span class="token keyword">DROP</span> <span class="token keyword">DEFAULT</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment"># ä¿®æ”¹ not null é™åˆ¶</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name 
<span class="token keyword">ALTER</span> <span class="token keyword">COLUMN</span> column_name 
<span class="token punctuation">[</span><span class="token keyword">SET</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token operator">|</span> <span class="token keyword">DROP</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment"># å¢åŠ checké™åˆ¶</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name 
<span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> constraint_name constraint_definition<span class="token punctuation">;</span>

<span class="token comment"># å¢åŠ å…¶ä»–é™åˆ¶</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name 
<span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> constraint_name constraint_definition<span class="token punctuation">;</span>

<span class="token comment"># é‡å‘½åè¡¨</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name 
<span class="token keyword">RENAME</span> <span class="token keyword">TO</span> new_table_name<span class="token punctuation">;</span>
</code></pre></div><!--]--></div></article></div></div></main><footer max-w="screen-lg" m="x-auto" w="full" p="y-8" text="dark:white dark:opacity-50 sm"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0 2021 Â© Jesse Chan</a></footer></div></div><script>!function(){var e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,a=localStorage.getItem("color-schema")||"auto";("dark"===a||e&&"light"!==a)&&document.documentElement.classList.toggle("dark",!0)}()</script></body></html>