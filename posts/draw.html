<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>
      Let Draw More Easier | Chan
    </title>
    <meta name="description" content="A PKM Site">
    <link rel="stylesheet" href="/assets/style.722ee15e.css">
    <link rel="modulepreload" href="/assets/framework.ab59a038.js">
    <link rel="modulepreload" href="/assets/posts_draw.md.40330124.lean.js">
    <link rel="modulepreload" href="/assets/app.99fa0b8e.js">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css">
    
  </head>
  <body>
    <div id="app"><div><main class="max-w-4xl mx-auto px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="pt-6 pb-8 space-y-2 md:space-y-5"><h3 class="text-xl leading-9 font-extrabold text-gray-900 tracking-tight sm:leading-10 md:leading-14"><a aria-label="Chan" href="/">Chan</a></h3></div><!--[--><article class="xl:divide-y xl:divide-gray-200" data-v-c610b9ce><header class="pt-6 xl:pb-10 space-y-1 text-center" data-v-c610b9ce><dl data-v-c610b9ce><dt class="sr-only">Published on</dt><dd class="text-base leading-8 font-medium text-gray-500"><time datetime="2021-01-31T12:00:00.000Z">January 31, 2021</time></dd></dl><h1 class="text-3xl leading-9 font-extrabold text-gray-900 tracking-tigh sm:text-4xl sm:leading-10 md:text-5xl md:leanding-14" data-v-c610b9ce>Let Draw More Easier</h1></header><div class="prose max-w-none pt-10 pb-8" data-v-c610b9ce><p>日常工作中我们会多或少有画图的需求，这些图不限于：流程图、示意图、折线图、柱状图等等。在能满足绘图需求的同时，也需要根据对应的场景选择对应的风格和格式。所以为了绘制出合适的图我们需要用到不同的工具。 这篇文章主要是程序员的角度来说一说如何在具体的场景下绘制出对应的图。</p><p>我个人比较倾向于能够通过书写代码的形式生成对应的图，但是这样往往会带来一些环境搭建以及编译转换中的负担，同时还要再学习一套新的语法，这也或多或少是对普通需求人的一种劝退，但是本文不尽然都是通过代码绘图的介绍，也会有一些通过鼠标拖拽形式的绘图工具。</p><p>好了，废话不多说，Let&#39;s Draw begin.</p><h2 id="上古神器"><a class="header-anchor" href="#上古神器" aria-hidden="true">#</a> 上古神器</h2><p>所谓的上古神器，指的是计算机比较初期时，Unix 上使用的一些工具。这些工具主要是用在文档排版上的，比如 《c程序设计语言》 K&amp;R 这个版本中介绍指针，二叉树的配图，又或是 APUE 中大量的示意图等等。这些配图在上世纪八九十年代时可以轻松的被绘制出来，而且看起来都很精美。 实际上这些书都是通过 troff 这个排版工具完成的。不同于 Tex， troff 在排版上相当完备且无需过多的折腾(关于 troff 我会写单独一片文章来介绍)。完成 troff 文档的编写是需要通过一组工具的配合才能完成的。上面提到的那些图实际上是通过 pic 这个标记语言完成的。</p><p>除了 <code>pic</code> 外，可以用在 troff 中的还有 <code>grap</code>, <code>dformat</code> 等。 目前大部分的 类Unix 发行版上都默认安装了这些工具，在 GNU 分支下，发型版中都是 groff， groff 中进行了一定扩展，但是基本的语法和使用方式基本没多大变化。</p><p>我们先看看 pic 是如何使用的，我们从一个简单例子开始：</p><div class="language-"><pre><code>.PS
arrow; box &quot;input&quot;; arrow; box &quot;process&quot;; arrow; box &quot;output&quot;;arrow
.PE
</code></pre></div><p>使用保存内容到 <code>a.ms</code> 中,运行：</p><div class="language-"><pre><code>$ pic a.ms | groff -ms -Tps | ps2pdf - &gt; a.pdf
</code></pre></div><p>这会在 pdf 中生成如下的图：</p><p><img src="/images/pic_ex.png" alt="pic_ex"></p><p>这个例子在写文档时能够直接在文档中插入，省去了打开绘图软件，绘制后保存并插入到指定的文档中的过程。这个例子是简单的介绍了 pic 的使用。 而当通过一定的脚本进行组合之后，可以对一些固定格式的图片进一步进行简化，比如 <code>dfromat</code>，这个用 awk 所完成的白十来行的脚本工具，可以用于绘制数据格式的图形。比如下面这个：</p><p><img src="/images/dformat_ex.png" alt="dformat_ex"></p><p>这是一个数据结构的比特位的示意图。你可能会觉得绘制这样的图会比较复杂，需要写很多的代码。然而只需要下面的这几行简单的代码就能完成：</p><div class="language-"><pre><code>.begin dformat
style bitwid 0.125
style linethrutext 0
CSR
   31-8 Reserved
   7    Lock
   6    Word
   5    Single
   4    Wake
   3-1  Max Transactions
   0    Stop
.end
</code></pre></div><p>而编译命令就只要：</p><div class="language-"><pre><code>$ awk -f dformat.awk bits.ms | pic | groff -Tps -ms  | ps2pdf - bits.pdf
</code></pre></div><p>这边的 dformat.awk 可以从 [<a href="https://github.com/arnoldrobbins/dformat" target="_blank" rel="noopener noreferrer">arnoldrobbins/dformat</a>] repo 中获取到。具体的使用可以查看 repo 中的使用说明。</p><p>上面说的工具是在 groff(troff) 文档中绘制一些表示图，但是如果我们要绘制图表时，在 troff 中可以使用 grap。 语法也是比较简单的。比如我们要绘制一个点图，只需要写如下的代码：</p><div class="language-"><pre><code>.G1
54.2
49.4
49.2
50.0
48.2
44.60
.G2
</code></pre></div><p>把内容保存在 olymp.g 中，并执行：</p><div class="language-"><pre><code>$ grap olymp.g | pic | groff -Tps -ms | ps2pdf - olymp.pdf
</code></pre></div><p>这会生成下面的图：</p><p><img src="/images/grap_ex.png" alt="grap_ex"></p><p>在快速绘图的情况下，这种方式算是非常简单而快捷得了。</p><p>说到绘图 <code>gnuplot</code> 也必须提一嘴，Gnuplot 是一款命令行绘制函数、数据等图表的工具。这在命令行中使用也是非常的简洁明了的。</p><p>比如我们定义了一个函数，想绘制出不同的参数下的参数情况。可以写下如下的代码：</p><div class="language-"><pre><code>set terminal png
set output &quot;./output/rand.png&quot;
g(x, s) = exp(-0.5*(x/s)**2)/s
plot g(x,1), g(x,2), g(x,3)
exit
</code></pre></div><p>将上述代码保存到 <code>rand</code> 中，此时只需要执行 <code>gnuplot rand</code> 即可。 执行无误后会在 output 中生成下面的图片：</p><p><img src="/images/rand.png" alt="rand.png"></p><p>这似乎和 python 的一些库比较类似。但实际上看语法 gnuplot 的形式比较接近数学的形式。但是学习的成本略微有一些高，一些细节上的语法和troff 比较类似，和现代的一些画图工具的差别有点大。</p><p>上面这些主要是命令行绘图工具，大部分可以在不安装任何依赖的情况下，开箱即用。当然了一些在 vim 中或者其他工具中的完成的绘图就另当别论了。其他的一些图片生成和处理工具就不在此细说了，比如：imageMagick/ffmpeg，这些工具涉及到更高一些的图片处理工作，我会在笔记或者另外的文章中整理这些。本文暂不讨论了。</p><h2 id="现代之作"><a class="header-anchor" href="#现代之作" aria-hidden="true">#</a> 现代之作</h2><p>随着时代的发展，很多的工具都在不断的简化，旨在降低使用门槛，或者是降低获取成本。这其中比较有名的是 [<a href="https://graphviz.org/" target="_blank" rel="noopener noreferrer">graphviz</a>] 和 platuml 等工具语言。 先说说 graphviz 吧.</p><h3 id="graphviz"><a class="header-anchor" href="#graphviz" aria-hidden="true">#</a> graphviz</h3><p>grahpviz 是一个开源的图像可视化软件。比较适合用来绘制结构化的图表和网络，依托 dot 语言，可以通过其他的语言批量生成一些图片绘制脚本。比如在一些性能监测程序中会通过 graphviz 来生成函数调用栈关系，内存申请层级关系等等。</p><p>我们首先从 dot 语言开始，简单的绘制几个图，先从最基本的一个图开始：</p><div class="language-"><pre><code>digraph G {
  size=&quot;4,4&quot;
  rankdir=LR
  node [shape=box, color=blue]
  node1 [style=filled]
  node2 [style=filled, fillcolor=red]

  node0-&gt;node1-&gt;node2
}
</code></pre></div><p>定义了一个有向图 G， 布局方向是从左到右(默认是从上到下的布局，这边通过 rankdir=LR 修改方向)。 三个节点，每个节点都是 box 形状的，边框是蓝色。 其中 node1 是用蓝色填充的， node2 是用红色填充的。 将上述代码保存在 <code>node.dot</code>，并运行下面的命令：</p><div class="language-"><pre><code>$ dot -Tpng node.dot -o node.png
</code></pre></div><p>就会生成下面的图形：</p><p><img src="/images/node.png" alt="node.png"></p><p>实际上大部分的示意图都可以通过 dot 绘制，比如绘制一个二叉树的表达式：</p><div class="language-"><pre><code>digraph ast {
    fontname = &quot;PingFang&quot;;
    fontszie = 10;

    node [shape = &quot;plaintext&quot;, fontname = &quot;PingFang&quot;, fontsize = 10];
    edge [fontname = &quot;PingFang&quot;, fontsize = 10];

    mul [label = &quot;mul(*)&quot;];
    add [label = &quot;add(+)&quot;];

    add -&gt; 3;
    add -&gt; 4;
    mul -&gt; add;
    mul -&gt; 5;
}
</code></pre></div><p>在这个例子中可以看到指定了字体和其大小，也修改节点的默认样式。编译后会生成下面的图像：</p><p><img src="/images/ast.png" alt="ast.png"></p><p>这种通过代码修改节点样式，不需要微调额外的关心节点之间间距的方式，对笔者而言是非常舒服的操作方式。不过痛点也是有的，要想实现一些比较骚的操作时，需要发散一下思维，以及要去翻阅文档，这一点对于使用鼠标画图工具而言灵活性稍微差点。不过当定义好节点样式之后，绘制图片也是非常方便的。</p><p>再举一例，通过 graphviz 绘制类似于 git 的 graph 示意图。</p><div class="language-"><pre><code>digraph G {
	rankdir=&quot;LR&quot;;
	node[width=0.15, height=0.15, shape=point, color=black];
	edge[weight=2, arrowhead=none, color=black];
	node[group=master];
	1 -&gt; 2 -&gt; 3 -&gt; 4 -&gt; 5;
	node[group=branch];
	2 -&gt; 6 -&gt; 7 -&gt; 4;
}
</code></pre></div><p>这会生成如下的示意图：</p><p><img src="/images/git.png" alt="git.png"></p><p>虽然在此时绘制这样的图用代码会显得有点冗余，但是在大量绘制的时候，在定义好节点样式后，绘制起来还是非常舒服的。</p><h3 id="plantuml"><a class="header-anchor" href="#plantuml" aria-hidden="true">#</a> PlantUML</h3><p>说到画图，则不得不说到 PlatnUML 这个开源的工具，在绘制时序图，用例图等等，甚至是一些非UML的图也是可以胜任的(不过这个和上述的 graphviz 也是有着一定的联系的)</p><p>一个最简单的例子：</p><div class="language-"><pre><code>@startuml
 Alice -&gt; Bob: test
@enduml
</code></pre></div><p>当你下载了 PlantUML 的 jar 包后，将上述内容保存到 <code>first.txt</code> 中，在命令执行：</p><div class="language-"><pre><code>$ java -jar plantuml.jar first.txt
$ ls 
first.png first.txt plantuml.jar 
</code></pre></div><p>生成的图像如下：</p><p><img src="/images/first_plantuml.png" alt="first_plantuml.png"></p><p>时序图在介绍流程时是非常好用的，之前的方式都是使用 visio 通过手动绘制，这个过程比较痛苦的是不停的在线段是否笔直和间距中调整。通过代码这个工作可以很快的完成。</p><p>对于这样的时序，如果在命令中加入 <code>-txt</code>， 则会生成 ASCII 形式的 txt 文件，比如：</p><div class="language-"><pre><code>$ java -jar plantuml.jar -txt first.txt
$ cat first.atxt
     ,-----.          ,---.
     |Alice|          |Bob|
     `--+--&#39;          `-+-&#39;
        |     test      |
        |--------------&gt;|
     ,--+--.          ,-+-.
     |Alice|          |Bob|
     `-----&#39;          `---&#39;
</code></pre></div><p>这对在代码中插入图形注释又提供了很大的便利，有关 ASCII 绘图的，后面会提到一些工具来实现。接下来让我们看看使用 plantUML 绘制 JSON 的结构图，使用如下的代码：</p><div class="language-"><pre><code>@startjson
{
  &quot;firstName&quot;: &quot;John&quot;,
  &quot;lastName&quot;: &quot;Smith&quot;,
  &quot;isAlive&quot;: true,
  &quot;age&quot;: 27,
  &quot;address&quot;: {
    &quot;streetAddress&quot;: &quot;21 2nd Street&quot;,
    &quot;city&quot;: &quot;New York&quot;,
    &quot;state&quot;: &quot;NY&quot;,
    &quot;postalCode&quot;: &quot;10021-3100&quot;
  },
  &quot;phoneNumbers&quot;: [
    {
      &quot;type&quot;: &quot;home&quot;,
      &quot;number&quot;: &quot;212 555-1234&quot;
    },
    {
      &quot;type&quot;: &quot;office&quot;,
      &quot;number&quot;: &quot;646 555-4567&quot;
    }
  ],
  &quot;children&quot;: [],
  &quot;spouse&quot;: null
}
@endjson
</code></pre></div><p>在经过编译之后，会生成如下的图像：</p><p><img src="/images/puml_json.png" alt="puml_json.png"></p><p>或许你会觉得这样的配色不是很舒服，plantUML 提供了修改箭头的颜色和样式等功能。让一些个性化定制成为可能。plantUML 也提供了很详细的文档说明和示例。方便我们学习和扩展，比如可以参考：</p><ul><li>[<a href="https://plantuml.com/zh/" target="_blank" rel="noopener noreferrer">官方文档</a>]</li><li>[<a href="https://crashedmind.github.io/PlantUMLHitchhikersGuide/" target="_blank" rel="noopener noreferrer">Hitchhiker&#39;s guide to PlantUML</a>]</li></ul></div></article><footer class="text-right my-12" data-v-c610b9ce><p class="author-show" data-v-c610b9ce>Chan</p></footer><!--]--></main></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"4ba7c645\",\"daily_20d10.md\":\"ca3edd83\",\"daily_20q01.md\":\"6dfd4483\",\"daily_20x11.md\":\"16c672b8\",\"daily_21b04.md\":\"4291f926\",\"daily_21b05.md\":\"af3c3d26\",\"daily_21b06.md\":\"89c066ca\",\"daily_21b07.md\":\"b786a751\",\"daily_21b11.md\":\"0a33a466\",\"daily_21b12.md\":\"4c306d93\",\"daily_21c04.md\":\"76d4df30\",\"daily_21d09.md\":\"7541a9c0\",\"posts_19x14.md\":\"74b0704d\",\"posts_20e01.md\":\"610cf89c\",\"posts_draw.md\":\"40330124\",\"posts_first_post.md\":\"1eb64573\",\"posts_openssl.md\":\"93f5bec6\",\"posts_tpp.md\":\"c2b801c7\"}")</script>
    <script type="module" async src="/assets/app.99fa0b8e.js"></script>
  </body>
</html>